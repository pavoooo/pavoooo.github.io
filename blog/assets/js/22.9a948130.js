(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{196:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",[t._v("XMLHttpRequest")]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),n("p",[t._v("这个方法在使用的时候有几个注意事项：")]),t._v(" "),t._m(26),t._v(" "),n("p",[t._v("比如：")]),t._v(" "),t._m(27),n("p",[t._v("当运行上述代码的时候，我们会看到请求头如下：")]),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._m(56),t._v(" "),t._m(57),t._v(" "),t._m(58),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),t._m(61),n("p",[t._v("对应结果如下：")]),t._v(" "),t._m(62),t._v(" "),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._m(67),t._v(" "),t._m(68),t._m(69),t._v(" "),t._m(70),t._m(71),t._v(" "),t._m(72),t._v(" "),t._m(73),n("p",[t._v("上面简单了介绍了关于"),n("code",[t._v("XMLHttpRequest")]),t._v("的一些相关特性。目前比较主流浏览器对于"),n("code",[t._v("XMLHttpRequest Level 2")]),t._v("基本上都实现了支持。兼容性详情可以参考"),n("a",{attrs:{href:"https://caniuse.com/#search=XMLHttpRequest",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://caniuse.com/#search=XMLHttpRequest"),n("OutboundLink")],1),t._v("。最后，关于"),n("code",[t._v("XMLHttpRequest")]),t._v("有一个很重要的事情需要说明--就是：跨域问题。对于这种问题的解决方案可以参考"),n("router-link",{attrs:{to:"/2018/跨域解决方案.html"}},[t._v("跨域解决方案")])],1)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("超文本传输协议(HTTP)是客户端和服务器进行通信的基础。"),s("code",[this._v("HTTP")]),this._v("包含"),s("code",[this._v("请求(Request)")]),this._v("和"),s("code",[this._v("响应(Response)")]),this._v("两部分。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("一个"),s("code",[this._v("HTTP")]),this._v("请求由"),s("strong",[this._v("4")]),this._v("部分组成：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("code",[t._v("HTTP")]),t._v("的请求方法")]),t._v(" "),n("li",[t._v("请求"),n("code",[t._v("url")])]),t._v(" "),n("li",[t._v("请求头")]),t._v(" "),n("li",[t._v("请求体")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("一个"),s("code",[this._v("HTTP")]),this._v("响应由"),s("strong",[this._v("3")]),this._v("部分组成：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("响应状态(状态码和文本描述)，用来显示请求的成功和失败")]),this._v(" "),s("li",[this._v("响应头部")]),this._v(" "),s("li",[this._v("响应体")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("Ajax")]),t._v("是浏览器向服务器发送请求的主要方式之一，这种请求方式的核心就是"),n("code",[t._v("XMLHttpRequest")]),t._v("。"),n("code",[t._v("XMLHttpReqtest")]),t._v("类的每个实例都是一个"),n("code",[t._v("请求/响应")]),t._v("对。下面就会对这个类进行"),n("code",[t._v("HTTP")]),t._v("通信的主要方式进行全面介绍。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("接下来的介绍中 "),s("code",[this._v("xhr")]),this._v(" 就表示 "),s("code",[this._v("XMLHttpRequest")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用这个"),s("code",[this._v("HTTP API")]),this._v("第一件事就是需要实力化"),s("code",[this._v("xhr")]),this._v("对象：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("这里需要事先说明一个注意点。我们应该对每个"),n("code",[t._v("http")]),t._v("请求实力化一个"),n("code",[t._v("xhr")]),t._v("对象。当然，你也可以复用已有的"),n("code",[t._v("xhr")]),t._v("进行"),n("code",[t._v("http")]),t._v("通信。但是，这会终止之前通过该"),n("code",[t._v("xhr")]),t._v("对象挂起的任何请求。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("除此，也需要对"),n("code",[t._v("xhr")]),t._v("有一个清晰的定位。"),n("code",[t._v("xhr")]),t._v("是浏览器级别的API而不是"),n("code",[t._v("HTTP")]),t._v("级别的API。"),n("code",[t._v("xhr")]),t._v("只关心请求和响应，而浏览器则需要考虑cookie，重定向，缓存和代理等因素。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所以，"),s("code",[this._v("xhr")]),this._v("所做的事情也很简单，就是"),s("strong",[this._v("发出请求")]),this._v("和"),s("strong",[this._v("获取响应")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("首先，我们先看一下怎么通过"),s("code",[this._v("xhr")]),this._v("发出"),s("code",[this._v("HTTP请求")]),this._v("？")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"xhr发送请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xhr发送请求","aria-hidden":"true"}},[this._v("#")]),this._v(" xhr发送请求")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("strong",[t._v("1.")]),t._v(" 发起"),n("code",[t._v("HTTP")]),t._v("请求的第一步就是通过"),n("code",[t._v("xhr.open")]),t._v("方法指定"),n("strong",[t._v("请求的方法")]),t._v("和"),n("strong",[t._v("请求的URL")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'GET'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'你的请求地址'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 创建一个 GET 请求")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("open()")]),t._v("方法的第一个参数就是指定请求方法。常见的如"),n("code",[t._v("GET")]),t._v("/"),n("code",[t._v("POST")]),t._v("/"),n("code",[t._v("PUT")]),t._v("/"),n("code",[t._v("HEAD")]),t._v("/"),n("code",[t._v("OPTIONS")]),t._v("都可以作为第一个参数传入。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第二个参数就是我们所请求的"),s("code",[this._v("url")]),this._v("地址，可以是相对地址也可以是绝对的请求地址。因为浏览器"),s("strong",[this._v("同源策略")]),this._v("的存在，跨域的请求通常被禁止。如果需要进行跨域请求，需要事先设置好相应的配置。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第三个参数是一个"),s("code",[this._v("Boolean")]),this._v("值。表示这个请求是同步请求(false)还是异步请求(true)。默认是"),s("code",[this._v("true")]),this._v("--即异步请求。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第四个和第五个参数经常成对出现，主要是用来指定服务器认证相关的信息。当然，我们也可以通过"),s("code",[this._v("Authorization")]),this._v("头部来进行指定。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面就是通过"),s("code",[this._v("xhr")]),this._v("请求的第一步。主要是设置进行"),s("code",[this._v("http")]),this._v("请求的一些必要条件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("2.")]),this._v(" 进行"),s("code",[this._v("http")]),this._v("请求的第二步对于"),s("code",[this._v("xhr")]),this._v("而言是一个可选的步骤。这一步主要是设置一些请求头，如果我们不需要自行设置请求头，则可以忽略这一步。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("设置请求头主要是通过"),s("code",[this._v("xhe.setRequestHeader")]),this._v("方法进行")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("setRequestHeader")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'请求头名称'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'请求头值'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("比如，为"),n("code",[t._v("POST")]),t._v("请求设置"),n("code",[t._v("Content-Type")]),t._v("的"),n("code",[t._v("MIME")]),t._v("类型为"),n("code",[t._v("json")]),t._v("：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("setRequestHeader")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'application/json'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("如果对相同的请求头多次调用"),s("code",[this._v("xhr.setRequestHeader")]),this._v("，"),s("strong",[this._v("新值是不会取代旧值的")]),this._v("。相反，"),s("code",[this._v("HTTP")]),this._v("请求会包含这个头部的多个副本或者这个头将指定多个值。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'GET'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./test1.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("setRequestHeader")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("setRequestHeader")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'text/plain'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/blog/xhr1.png",alt:"xhr"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("有些浏览器自动添加的头部我们是不能设置的。比如，我们不能通过这个方法设置"),s("code",[this._v("Content-Length")]),this._v("，"),s("code",[this._v("User-Agent")]),this._v("等头部的内容。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("3.")]),this._v(" 发送请求的第三步也是最后一个步骤--就是通过"),s("code",[this._v("xhr.send()")]),this._v("方法指定请求主体，并将其发送到服务器上。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 请求主体为空")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("stringify")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"name"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"saisai"')]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 发送具体的请求主体")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("上面就是通过"),n("code",[t._v("xhr")]),t._v("发送请求的基本过程。过程很简单，但是我们需要知道一个重要的注意事项就是，"),n("code",[t._v("HTTP")]),t._v("请求的各部分是有指定顺序的：**请求方法和url首先到达，然后是请求头，最后是请求体。**所以，我们在使用"),n("code",[t._v("xhr")]),t._v("发送请求的时候，也要严格的遵循上面的顺序。比如"),n("code",[t._v("setRequestHeader()")]),t._v("方法的调用需要在"),n("code",[t._v("open()")]),t._v("之后"),n("code",[t._v("send()")]),t._v("之前，否则会抛出异常。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/blog/xhr2.png",alt:"xhr"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("了解了通过"),s("code",[this._v("xhr")]),this._v("发送请求的基本过程后，我们需要了解怎么通过"),s("code",[this._v("xhr")]),this._v("接收"),s("code",[this._v("http")]),this._v("响应的内容。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"xhr接收响应"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xhr接收响应","aria-hidden":"true"}},[this._v("#")]),this._v(" xhr接收响应")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("一个完整的"),n("code",[t._v("http")]),t._v("响应由"),n("code",[t._v("状态码")]),t._v("，"),n("code",[t._v("响应头集合")]),t._v("和"),n("code",[t._v("响应主体")]),t._v("组成。这些我们可以通过"),n("code",[t._v("xhr")]),t._v("对象上的属性和方法来获得：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("p",[n("code",[t._v("status")]),t._v("和"),n("code",[t._v("statusText")]),t._v("属性用来获取"),n("code",[t._v("http")]),t._v("响应的状态码和描述文本的")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("getResponseHeader()")]),t._v("和"),n("code",[t._v("getAllResponseHeaders()")]),t._v("用来获取"),n("code",[t._v("http")]),t._v("响应的响应头信息")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("responseText")]),t._v("属性可以用来获取响应主体。("),n("code",[t._v("responseXML")]),t._v("也可以用来获取特定响应格式下的响应主体。这种前后端数据交流方式平时开发很少见，不再赘述。)")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("xhr")]),t._v("在进行"),n("code",[t._v("http")]),t._v("操作的整个过程中("),n("code",[t._v("请求")]),t._v("和"),n("code",[t._v("响应")]),t._v(")具有不同的状态。每次状态变更，都会触发"),n("code",[t._v("xhr")]),t._v("的"),n("code",[t._v("readystatechange")]),t._v("事件。所以，我们可以通过监听这个事件，并通过"),n("code",[t._v("xhr.readyState")]),t._v("获取当前"),n("code",[t._v("xhr")]),t._v("所处于的状态。总的来说，"),n("code",[t._v("xhr")]),t._v("在整个通信的过程中会发生取下几种状态的变更：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("strong",[t._v("0 -- open()尚未调用")])]),t._v(" "),n("li",[n("strong",[t._v("1 -- open()已经调用")])]),t._v(" "),n("li",[n("strong",[t._v("2 -- 接收到响应头信息")])]),t._v(" "),n("li",[n("strong",[t._v("3 -- 接收到响应主体")])]),t._v(" "),n("li",[n("strong",[t._v("4 -- 响应完成")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为了能够监听"),s("code",[this._v("readyState")]),this._v("的状态变化，我们需要为"),s("code",[this._v("xhr")]),this._v("的"),s("code",[this._v("readystatechange")]),this._v("事件设置事件监听程序。比如：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 定义事件处理程序")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 下面的状态代表请求完成，而且请求是成功的")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("4")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("200")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 对请求成功的结果进行处理")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在响应成功后我们需要通过"),s("code",[this._v("xhr.responseText")]),this._v("获取服务器响应的内容。"),s("code",[this._v("xhr.responseText")]),this._v("属性只能够用于文本，不能够处理二进制响应，"),s("code",[this._v("xhr2")]),this._v("定义了处理二进制响应的方法，后续会看到。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("服务器响应的正常解码的前提是服务器为这个响应发送了"),n("code",[t._v("Content-Type")]),t._v("和正确的"),n("code",[t._v("MIME")]),t._v("类型。一旦服务器设置了错误的响应类型，客户端在接收到响应的时候并不能正确的识别。从而会使用错误的响应类型来解析响应。"),n("code",[t._v("xhr2")]),t._v("定义了一种客户端可以覆盖掉服务器端响应的"),n("code",[t._v("MIME type")]),t._v("的方式，即："),n("code",[t._v("overrideMimeType()")]),t._v(" 方法。这个方法需要在"),n("code",[t._v("send()")]),t._v("方法调用之前被调用。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("overrideMimeType")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'text/plain; charset=utf-8'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"xmlhttprequest2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xmlhttprequest2","aria-hidden":"true"}},[this._v("#")]),this._v(" XMLHttpRequest2")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("xhr2")]),t._v("可以看作是"),n("code",[t._v("xhr")]),t._v("的升级版本，这个版本可以实现很多"),n("code",[t._v("xhr")]),t._v("所不能实现的功能。比如我们是无法依靠"),n("code",[t._v("xhr")]),t._v("来实现文件上传功能的，因为"),n("code",[t._v("xhr")]),t._v("的"),n("code",[t._v("send()")]),t._v("方法只能发送普通的文本。同样，我们也不能通过"),n("code",[t._v("xhr")]),t._v("来接收服务器传送过来的二进制数据流。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在"),s("code",[this._v("xhr2")]),this._v("中，"),s("code",[this._v("send()")]),this._v("方法是可以传入一个"),s("code",[this._v("File")]),this._v("对象。我们可以利用这个特性来实现文件上传的功能。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("当我们通过"),n("code",[t._v('<input type="file" />')]),t._v("选取文本文件的时候，这个元素拥有一个"),n("code",[t._v("files")]),t._v("属性。这个属性是一个类数组对象，每个元素都是一个"),n("code",[t._v("File")]),t._v("对象。我们可以将这个对象传入"),n("code",[t._v("send()")]),t._v("方法并通过"),n("code",[t._v("POST")]),t._v("方式传递给我们的服务器。下面是通过"),n("code",[t._v("xhr2")]),t._v("来实现文件上传的例子：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" input "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'file'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ninput"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'change'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ev"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" file "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("files"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'POST'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'服务器地址'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 将File对象作为send方法的参数发送")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("上面就是通过"),n("code",[t._v("xhr2")]),t._v("进行文件上传的一个简单例子。其实"),n("code",[t._v("xhr2")]),t._v("允许向"),n("code",[t._v("send()")]),t._v("方法传入任何的"),n("code",[t._v("Blob")]),t._v("对象。如果没有设置"),n("code",[t._v("Content-Type")]),t._v("头部，这个"),n("code",[t._v("Blob")]),t._v("对象的"),n("code",[t._v("type")]),t._v("属性就是默认的"),n("code",[t._v("Content-Type")]),t._v("。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("除了能够进行文件上传，"),n("code",[t._v("xhr2")]),t._v("还能够发送更为复杂的"),n("code",[t._v("multipart/form-data")]),t._v("请求。我们知道，当我们使用html表单同时上传文件和其他元素的时候，浏览器是不能使用普通的表单编码而必须使用"),n("code",[t._v("multipart/form-data")]),t._v("这种特殊的"),n("code",[t._v("Content-Type")]),t._v("用"),n("code",[t._v("POST")]),t._v("来提交表单。这种编码会使用长“边界”字符串把请求分为多个部分。"),n("code",[t._v("xhr2")]),t._v("也定义了新的"),n("code",[t._v("FormData")]),t._v("数据类型，它能够很容易的实现多部分请求主体。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("首先使用"),s("code",[this._v("FormData")]),this._v("构造函数创建"),s("code",[this._v("FormData")]),this._v("对象。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("然后按需多次调用这个对象的"),s("code",[this._v("append")]),this._v("方法把个体部分（可以是字符串，File或者Blob对象）添加到请求中")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("最后，把"),n("code",[t._v("FormData")]),t._v("对象传递给"),n("code",[t._v("send")]),t._v("方法。"),n("code",[t._v("send")]),t._v("方法会将请求定义合适的边界字符串和设置"),n("code",[t._v("Content-Type")]),t._v("头。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'POST'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'url地址'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" formData "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("FormData")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nformData"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("append")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 将 formData 对象传入send方法。xhr会自动设置请求的 Content-Type 的头")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("formData"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("上面简单的介绍了"),n("code",[t._v("xhr2")]),t._v("的一些很常用且在"),n("code",[t._v("xhr")]),t._v("中无法实现的特性。除此之外，"),n("code",[t._v("xhr2")]),t._v("还增加了很多其他的特性。比如，在"),n("code",[t._v("xhr")]),t._v("中，我们在发送"),n("code",[t._v("http")]),t._v("请求的时候，使用"),n("code",[t._v("readystatechange")]),t._v("并结合"),n("code",[t._v("readyState")]),t._v("来探测"),n("code",[t._v("xhr")]),t._v("的状态。"),n("code",[t._v("xhr2")]),t._v("规范定义了很多有用的事件集，即"),n("code",[t._v("xhr")]),t._v("对象在请求的不同阶段会触发不同类型的事件，所以我们不需要检查"),n("code",[t._v("readyState")]),t._v("属性就能获取到"),n("code",[t._v("xhr")]),t._v("的状态。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在"),s("code",[this._v("xhr2")]),this._v("中这些新事件可能会向下面这样触发：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[t._v("当调用"),n("code",[t._v("send()")]),t._v("时，会触发"),n("code",[t._v("loadstart")]),t._v("事件")]),t._v(" "),n("li",[t._v("当在加载服务器的响应的过程中，"),n("code",[t._v("xhr")]),t._v("对象会触发"),n("code",[t._v("progress")]),t._v("事件。这个事件通常每隔"),n("code",[t._v("50ms")]),t._v("左右触发一次，我们可以基于这个事件为用户带来响应过程中的实时反馈。")]),t._v(" "),n("li",[t._v("当响应完成的时候，会触发"),n("code",[t._v("load")]),t._v("事件。我们可以在这个事件中检查响应的状态码来确定响应成功与否。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当然，响应并不会100%成功。"),s("code",[this._v("xhr2")]),this._v("针对失败的响应也会根据失败的原因触发不同类型的事件：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[t._v("如果请求超时，会触发"),n("code",[t._v("timeout")]),t._v("事件")]),t._v(" "),n("li",[t._v("如果请求终止，会触发"),n("code",[t._v("abort")]),t._v("事件")]),t._v(" "),n("li",[t._v("如果请求因为网络等原因发生了错误，会触发"),n("code",[t._v("error")]),t._v("事件")]),t._v(" "),n("li",[t._v("不管请求或响应成功与否，在结束的时候，"),n("code",[t._v("xhr")]),t._v("就会触发"),n("code",[t._v("loadend")]),t._v("事件")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'GET'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./test1.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onloadstart")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'开始请求'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onloadend")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'xhr结束'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'响应结束'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'xhr出错'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/blog/xhr3.png",alt:"xhr"}})])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("xhr2")]),t._v("规范中对"),n("code",[t._v("progress")]),t._v("事件作了很多的规范。进度事件在"),n("code",[t._v("xhr2")]),t._v("中主要分为两种："),n("code",[t._v("响应进度事件")]),t._v("和"),n("code",[t._v("请求(上传)进度事件")]),t._v("。进度事件的事件对象中，除了常规的"),n("code",[t._v("type")]),t._v("和"),n("code",[t._v("timestamp")]),t._v("这样的对象属性外，还有与"),n("code",[t._v("progress")]),t._v("事件相关联的三个比较有用的属性：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("strong",[t._v("loaded")]),t._v("：表示已经传输的字节数值")]),t._v(" "),n("li",[n("strong",[t._v("total")]),t._v("：表示传输数据的整体长度")]),t._v(" "),n("li",[n("strong",[t._v("lengthComputable")]),t._v("：如果知道内容长度则为true，否则为false")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("响应进度事件，我们可以通过监听"),s("code",[this._v("xhr")]),this._v("的"),s("code",[this._v("onprogress")]),this._v("事件来处理")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onprogress")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("对于请求(上传)进度事件，我们不能直接通过"),n("code",[t._v("xhr")]),t._v("来监听对应的事件。"),n("code",[t._v("xhr2")]),t._v("中为"),n("code",[t._v("xhr")]),t._v("对象增加了"),n("code",[t._v("upload")]),t._v("属性，这个属性是一个对象，可以通过这个对象来监听请求上传的进度事件。比如在上面图片上传的例子中，我们就可以通过"),n("code",[t._v("xhr.upload.onprogress")]),t._v("来监听上传进度")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" input "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'file'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ninput"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'change'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ev"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" file "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("files"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'POST'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'服务器地址'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 将File对象作为send方法的参数发送")]),t._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 监听上传进度")]),t._v("\n  xhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("upload"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onprogress")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ev"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" loaded"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" total "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" ev\n    console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[t._v("`已经上传")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("loaded"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{attrs:{class:"token string"}},[t._v("/")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("total"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{attrs:{class:"token string"}},[t._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("xhr2")]),this._v("除了增加了上述实用的事件外，还增加了手动停止请求和处理超时等功能。我们可以通过调用"),s("code",[this._v("xhr.abort()")]),this._v("方法来取消正在进行的请求。一旦取消成功，"),s("code",[this._v("onabort")]),this._v("事件就会触发：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'GET'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./test1.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onabort")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'请求aborted'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("abort")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/blog/xhr4.png",alt:"xhr"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("对于超时，"),s("code",[this._v("xhr2")]),this._v("定义了"),s("code",[this._v("timeout")]),this._v("属性来指定请求自动终止的毫秒数。一旦请求自动终止，"),s("code",[this._v("ontimeout")]),this._v("事件就会触发：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'GET'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./test1.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("ontimeout")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'请求aborted'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timeout "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),t._v("\nxhr"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])])}],!1,null,null,null);e.options.__file="XMLHttpRequest.md";s.default=e.exports}}]);