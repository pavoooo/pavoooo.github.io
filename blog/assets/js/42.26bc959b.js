(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{254:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("h1",[s._v("iptables学习")]),s._v(" "),t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),t("p",[t("code",[s._v("iptables")]),s._v("的全称是"),t("code",[s._v("netfilter/iptables")]),s._v("，是"),t("code",[s._v("ip")]),s._v("信息包过滤系统，由"),t("code",[s._v("netfilter")]),s._v("和"),t("code",[s._v("iptables")]),s._v("两部分组成。")]),s._v(" "),t("p",[t("code",[s._v("netfilter")]),s._v("组件也称为内核空间"),t("code",[s._v("kernelspace")]),s._v("，它是内核的一部分，由一些信息包过滤表组成，这些表包含内核用来控制信息包过滤处理的规则集。")]),s._v(" "),t("p",[t("code",[s._v("iptables")]),s._v("其实是一种工具，也称为用户控件"),t("code",[s._v("userspace")]),s._v("，它使插入、修改和删除信息包过滤表中的规则变得容易。")]),s._v(" "),t("p",[t("code",[s._v("netfilter/iptables")]),s._v("也简称为"),t("code",[s._v("iptables")]),s._v("。"),t("code",[s._v("iptables")]),s._v("是基于内核的防火墙，功能很强大。"),t("code",[s._v("iptables")]),s._v("中内置了"),t("code",[s._v("filter")]),s._v("，"),t("code",[s._v("nat")]),s._v("，"),t("code",[s._v("mangle")]),s._v("三张表。三张表的任一处变更都会立即生效，不需要重启。")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("filter")]),s._v("表：负责过滤数据包，包括的规则链有"),t("code",[s._v("INPUT")]),s._v("，"),t("code",[s._v("OUTPUT")]),s._v("和"),t("code",[s._v("FORWARD")]),s._v("。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("nat")]),s._v("表：涉及到网络地址转换，包括的规则链有"),t("code",[s._v("PREROUTING")]),s._v("，"),t("code",[s._v("POSTROUTING")]),s._v("和"),t("code",[s._v("OUTPUT")]),s._v("。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("mangle")]),s._v("表：主要用在修改数据包内容上，用来给数据包打个标识，默认的规则链有"),t("code",[s._v("INPUT")]),s._v("，"),t("code",[s._v("OUTPUT")]),s._v("，"),t("code",[s._v("FORWARD")]),s._v("和"),t("code",[s._v("PREROUTING")]),s._v("，"),t("code",[s._v("POSTROUTING")]),s._v("。")])])]),s._v(" "),t("p",[t("code",[s._v("iptables")]),s._v("涉及"),t("strong",[s._v("三表")]),s._v("和"),t("strong",[s._v("五链")]),s._v("，三表就是上面提到的，五链如下：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("INPUT")]),s._v("：匹配流入到本机的数据包，也就是目标"),t("code",[s._v("ip")]),s._v("地址是本机")]),s._v(" "),t("li",[t("code",[s._v("OUTPUT")]),s._v("：匹配从本机流出的数据包，一般不需要作配置")]),s._v(" "),t("li",[t("code",[s._v("FORWARD")]),s._v("：匹配从本机进行转发的数据包，目标"),t("code",[s._v("ip")]),s._v("地址不是本机。")]),s._v(" "),t("li",[t("code",[s._v("PREROUTING")]),s._v("：用来修改目的地址，用来做"),t("code",[s._v("DNAT")]),s._v("。比如可以把内网中的"),t("code",[s._v("80")]),s._v("端口，映射到路由器外网端口上。")]),s._v(" "),t("li",[t("code",[s._v("POSTROUTING")]),s._v("：用来修改源地址，做"),t("code",[s._v("SNAT")]),s._v("。比如内网通过路由器"),t("code",[s._v("NAT")]),s._v("转换功能实现内网机器通过一个公网"),t("code",[s._v("IP")]),s._v("地址上网。")])]),s._v(" "),t("blockquote",[t("p",[s._v("表 -> 链 -> 规则")])]),s._v(" "),t("p",[t("strong",[s._v("iptable过滤封包流程")])]),s._v(" "),t("p",[t("img",{attrs:{src:"'/blog/iptables1.png'",alt:""}})]),s._v(" "),t("p",[s._v("数据包可以分为两类：")]),s._v(" "),t("ul",[t("li",[s._v("发给防火墙本身的数据包*(数据包流向用红色线表示)*")]),s._v(" "),t("li",[s._v("需要经过防火墙转发的数据包*(数据包流向用蓝色线表示)*")])]),s._v(" "),t("p",[t("code",[s._v("iptables")]),s._v("中的三个表是有优先顺序的，一般顺序优先规则如下")]),s._v(" "),t("p",[t("code",[s._v("raw > mangle > nat > filter")])]),s._v(" "),t("p",[s._v("规则链间的匹配顺序")]),s._v(" "),t("ul",[t("li",[s._v("入站数据："),t("code",[s._v("PREROUTING")]),s._v(", "),t("code",[s._v("INPUT")])]),s._v(" "),t("li",[s._v("出站数据："),t("code",[s._v("OUTPUT")]),s._v(", "),t("code",[s._v("POSTROUTING")])]),s._v(" "),t("li",[s._v("转发数据："),t("code",[s._v("PREROUTING")]),s._v(", "),t("code",[s._v("FORWARD")]),s._v(", "),t("code",[s._v("POSTROUTING")])])]),s._v(" "),t("p",[s._v("链内的匹配顺序")]),s._v(" "),t("ul",[t("li",[s._v("自上而下按照顺序依次进行检查，找到相匹配的规则即停止")]),s._v(" "),t("li",[s._v("如果在链内找不到相匹配的规则，则按照该链的默认策略处理（未修改的情况下，默认策略是允许）")])]),s._v(" "),t("h2",{attrs:{id:"iptables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iptables","aria-hidden":"true"}},[s._v("#")]),s._v(" iptables")]),s._v(" "),t("p",[s._v("查看本机是否安装了防火墙"),t("code",[s._v("iptables")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rpm -qf "),t("span",{attrs:{class:"token variable"}},[t("span",{attrs:{class:"token variable"}},[s._v("`")]),t("span",{attrs:{class:"token function"}},[s._v("which")]),s._v(" iptables"),t("span",{attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("iptables")]),s._v("的配置文件一般保存在")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/etc/sysconfig/iptables\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("配置文件的内容可能如下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# Generated by iptables-save v1.4.7 on Sat Jul 21 09:26:53 2018")]),s._v("\n*filter\n:INPUT ACCEPT "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0:0"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n:FORWARD ACCEPT "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0:0"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n:OUTPUT ACCEPT "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5:1020"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n-A INPUT -p tcp -m tcp --dport 8080 -j ACCEPT\n-A INPUT -p tcp -m tcp --dport 8080 -j ACCEPT\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A FORWARD -j REJECT --reject-with icmp-host-prohibited\nCOMMIT\n"),t("span",{attrs:{class:"token comment"}},[s._v("# Completed on Sat Jul 21 09:26:53 2018")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[t("code",[s._v("iptables")]),s._v("启动和重启")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/etc/init.d/iptables start\n/etc/init.d/iptables restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("检查开机是否启动了")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --list iptables\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# iptables       \t0:关闭\t1:关闭\t2:关闭\t3:关闭\t4:关闭\t5:关闭\t6:关闭")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("code",[s._v("iptables")]),s._v("命令的语法格式")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-t 表名"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 管理选项 "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("链名"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("规则名"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("条件匹配"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-j 目标动作或者跳转"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("不指定表名的时候，默认是"),t("code",[s._v("filter")]),s._v("表")]),s._v(" "),t("li",[s._v("不指定链名的时候，默认是该表内的所有链")]),s._v(" "),t("li",[s._v("除非设置规则链的缺省策略，否则需要指定匹配条件")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/blog/iptables2.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"iptables命令使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iptables命令使用","aria-hidden":"true"}},[s._v("#")]),s._v(" iptables命令使用")]),s._v(" "),t("p",[t("code",[s._v("iptables")]),s._v("的基本使用方法如下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-t 要操作的表"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("操作命令"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("要操作的链"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("规则号码"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("匹配条件"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-j 匹配到以后的动作"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("操作命令")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-A <链名>")]),s._v("："),t("code",[s._v("APPEND")]),s._v("，追加一条规则，放到最后。")])]),s._v(" "),t("p",[s._v("比如，在"),t("code",[s._v("filter")]),s._v("表的"),t("code",[s._v("INPUT")]),s._v("链里追加一条规则（作为最后一条规则），匹配所有访问本机"),t("code",[s._v("IP")]),s._v("的数据包，匹配到就丢弃")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 这个规则就是拒绝所有人访问服务器")]),s._v("\niptables -t filter -A INPUT -j DROP\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# -j DROP 表示丢弃包")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("-D <链名><规则名称|具体规则内容>")]),s._v("："),t("code",[s._v("DELETE")]),s._v("，删除一条规则")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 删除 filter表中的INPUT 链对应的弟一条规则")]),s._v("\niptables -D INPUT 1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v('# 删除filter表中 INPUT链中内容为"-s 192.168.144.129 -j DROP"的规则')]),s._v("\niptables -t filter -D INPUT -s 192.168.144.129 -j DROP\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("删除规则的时候有一些注意事项")]),s._v(" "),t("ol",[t("li",[s._v("如果规则列表中有多条相同的规则，按内容匹配删除序号最小的一条")]),s._v(" "),t("li",[s._v("按照号码匹配删除的时候，确保规则号码 <= 已有规则数，否则报错")]),s._v(" "),t("li",[s._v("按照内容匹配删除的时候，确保规则存在，否则报错")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-P <链名> <动作>")]),s._v("："),t("code",[s._v("POLICY")]),s._v("，设置某个链的默认规则")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -L "),t("span",{attrs:{class:"token comment"}},[s._v("# 查看默认规则")]),s._v("\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 设置默认规则为DROP")]),s._v("\niptables -t filter -P INPUT DROP\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("code",[s._v("-F <链名>")]),s._v("："),t("code",[s._v("FLUSH")]),s._v("，清空规则")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 清空INPUT链的规则")]),s._v("\niptables -t filter -F INPUT\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 清除filter表中所有链上的规则")]),s._v("\niptables -F\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 清除nat表中链上所有的规则")]),s._v("\niptables -t NAT -F\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("strong",[s._v("注意")])]),s._v(" "),t("ol",[t("li",[t("code",[s._v("-F")]),s._v("仅仅是清空链中的规则，并不影响"),t("code",[s._v("-P")]),s._v("设置的默认规则")]),s._v(" "),t("li",[t("code",[s._v("-P")]),s._v(" 设置了"),t("code",[s._v("DROP")]),s._v("后，使用"),t("code",[s._v("-F")]),s._v("一定要小心")]),s._v(" "),t("li",[s._v("如果不写链名称，则清空所有链上的规则。")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-[xvf]L <链名>")]),s._v(": "),t("code",[s._v("LIST")]),s._v("列出所有的规则")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 列出所有链的规则")]),s._v("\niptables -L\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 列出INPUT链的所有规则")]),s._v("\niptables -L INPUT\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("v")]),s._v("：显示详细信息")]),s._v(" "),t("li",[t("code",[s._v("x")]),s._v("：在"),t("code",[s._v("v")]),s._v("的基础上，禁止自动单位换算")]),s._v(" "),t("li",[t("code",[s._v("n")]),s._v("：只显示"),t("code",[s._v("IP")]),s._v("地址和端口号码，不显示域名和服务名称")])]),s._v(" "),t("p",[t("strong",[s._v("匹配条件")])]),s._v(" "),t("ol",[t("li",[s._v("流入、流出的接口（"),t("code",[s._v("-i")]),s._v("，"),t("code",[s._v("-o")]),s._v("）")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-i <匹配数据进入的网络接口>")]),s._v("：这个参数主要用于"),t("code",[s._v("nat")]),s._v("表，比如目标地址转换")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 匹配是否从网络接口 eth0进来的数据包")]),s._v("\n-i eth0\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配是否从网络接口 eth0流出的数据包")]),s._v("\n-o eth0\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配是否从网络接口 ppp0进来的数据包")]),s._v("\n-i ppp0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("来源、目的地址（"),t("code",[s._v("-s")]),s._v(", "),t("code",[s._v("-d")]),s._v("）")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-s <匹配来源地址>")]),s._v("：可以是ip, net, domain，也可以为空（表示全部）")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 匹配来自192.168.0.1的数据包")]),s._v("\n-s 192.168.0.1\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配来自于192.168.0.1/24网段的数据包")]),s._v("\n-s 192.168.0.1/24\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配即将去往192.168.22.214的数据包")]),s._v("\n-d 192.168.22.214\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("协议类型（"),t("code",[s._v("-p")]),s._v("）")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-p <协议类型>")]),s._v("：可以是tcp，udp，icmp等，也可以为空")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 匹配tcp相关的数据包")]),s._v("\n-p tcp\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配udp相关的协议")]),s._v("\n-p udp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("来源、目的端口（"),t("code",[s._v("--sport")]),s._v(", "),t("code",[s._v("--dport")]),s._v("）")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("--sport <匹配源端口>")]),s._v("：可以是个别端口，也可以是端口范围")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 匹配目标端口是 80 的数据包")]),s._v("\n--dport 80 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("--dport <匹配目的端口>")]),s._v("：可以是个别端口，也可以是端口范围")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 匹配源端口是1000的数据包")]),s._v("\n--sport 1000 \n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配源端口是1000-3000的数据包")]),s._v("\n--sport 1000:3000\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配源端口在3000以下的数据包")]),s._v("\n--sport :3000\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配源端口是1000以上的数据包")]),s._v("\n--sport 1000:\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("blockquote",[t("p",[s._v("--sport 和 --dport必须和-p一起使用")])]),s._v(" "),t("p",[s._v("比如")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 匹配网络中目的端口是53的udp协议数据包")]),s._v("\n-p udp --dport 53\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 匹配来自 192.168.0.1 访问 www.zhaosaisai.com:80的数据包")]),s._v("\n-s 192.168.0.1 -d www.zhaosaisai.com -p tcp --dport 80\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("动作（处理方式）")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ACCEPT")]),s._v("：接收数据包")]),s._v(" "),t("li",[t("code",[s._v("DROP")]),s._v("：直接将数据包丢弃（不给对方任何回应）")]),s._v(" "),t("li",[t("code",[s._v("REJECT")]),s._v("：拒绝数据包（拒绝后，给对端一个回应）")]),s._v(" "),t("li",[t("code",[s._v("SNAT")]),s._v("：源地址转换")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("-j SNAT --to IP"),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-IP"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":端口-端口"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nat 表上的POSTROUTING"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n源地址转换，SNAT支持转换到单IP地址，也支持转换到一组IP地址\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("DNAT")]),s._v("：端口映射")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("-j DNAT --to IP"),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-IP"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":端口-端口"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nat 表上的PREROUTING"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n目标地址转换，DNAT支持转换到单IP地址，也支持转换到一组IP地址\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("MASQUERADE")]),s._v("：伪装一个公网"),t("code",[s._v("ip")]),s._v("地址")])]),s._v(" "),t("p",[s._v("下面是这些处理方式的使用方式")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 接受，允许数据包通过本链访问而不拦截它")]),s._v("\n-j ACCEPT\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 从INPUT进来的数据包都是接受的")]),s._v("\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 也就是允许任何人访问")]),s._v("\niptables -A INPUT -j ACCEPT\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 阻止转发 是 192.168.20.39 的数据包访问本机")]),s._v("\niptables -A FORWARD -s 192.168.20.39 -j DROP\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 将内网192.168.22.214的原地址转换为公网ip 1.1.1.1 用于NAT")]),s._v("\niptables -t nat -A POSTROUTING -s 192.168.22.214 -j SNAT --to 1.1.1.1\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 把从etch0进来的数据包目的地址改为192.168.22.214")]),s._v("\niptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to 192.168.22.214\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h2",{attrs:{id:"实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例","aria-hidden":"true"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),t("p",[t("strong",[s._v("1. 使用iptables防火墙保护web服务器")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 首先对网路lo进行配置")]),s._v("\niptables -A INPUT -i lo -j ACCEPT\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 打开22和80端口（一次打开多个）")]),s._v("\n"),t("span",{attrs:{class:"token comment"}},[s._v("# iptables -A INPUT -p tcp -m multiport --dport 22,80 -j ACCEPT")]),s._v("\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 打开22和80端口（分多次打开）")]),s._v("\niptables -A INPUT -p tcp --dport 22 -j ACCEPT\niptables -A INPUT -p tcp --dport 80 -j ACCEPT\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 对衍生的和已经建立的连接放行")]),s._v("\niptables -A INPUT -m state -state RELATED,ESTABLISHED -j ACCEPT\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 其它的数据默认都drop")]),s._v("\niptables -P INPUT DROP\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[t("strong",[s._v("2. 拒绝访问服务器本身和拒绝通过服务器访问别的机器")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 拒绝一个ip地址的访问")]),s._v("\niptables -A INPUT -s 192.168.2.1 -j DROP\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 防止通过本机转发")]),s._v("\niptables -A FORWARD -s 192.168.2.1 -j DROP\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 禁止这个机器上网")]),s._v("\niptables -A OUTPUT -s 192.168.2.1 -j DROP\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])}],!1,null,null,null);e.options.__file="iptables学习.md";a.default=e.exports}}]);