# vim的使用

`vim`主要是用来在终端中编辑文件的。它是一个同`vi`向上兼容的文本编辑器。

```bash
vim file
```

`vim`的四种模式

- 正常模式(Normal-mode)
- 插入模式(Insert-mode)
- 命令模式(Command-mode)
- 可视模式(Visual-mode)

## 正常模式

直接通过`vim`打开一个文件就进入了`vim`的正常模式。通过以下命令可以进入插入模式。

- `i`：光标在当前位置
- `I`: 光标会移动到当前行的开头
- `a`: 光标会向后移动一个字符
- `A`：光标会移动到该行的末尾
- `o`：在当前光标所在行的下面添加一个空行，并将光标移动到该空行最前面
- `O`：在当前光标所在行的上面添加一个空行，并将光标移动到该空行最前面

> 其他模式下可以按下`esc`进入到正常模式

在正常模式下可以输入`:wq`对该文件进行保存退出。

**1. 光标移动**

- `h`: 向左移动
- `j`：向下移动
- `k`：向上移动
- `l`：向右移动

**2. 复制和粘贴**
- `yy`：复制当前行的内容
- `p`：粘贴复制的内容
- `(number)yy`：从当前行开始向下复制`number`行
- `y$`：复制从光标的位置到当前行的结尾
- `dd`：剪切当前行
- `(number)dd`：从当前行开始向下剪切`number`行
- `d$`：从光标所在位置剪切到行末尾
- `u`：撤销操作

> 多次按`u`进行多次撤销

- `ctrl+r`：恢复操作

**3. 光标操作**
- `x`：删除光标所在位置的字符
- `r`：对光标所在位置的字符进行替换
- `(number)G`：将光标移动到`number`行的行首位置
- `gg`：将光标移动到文件第一行行首
- `GG`：将光标移动到文件最后一行行首
- `^`：将光标移动到该行行首
- `$`：将光标移动到该行末尾

## 命令模式

命令模式主要是对文件的操作，可以对文件进行保存，退出，查找和替换等功能。

> `:`可以进入命令模式

- `w`：保存文件

使用`w`进行文件保存的时候，可以指定文件的保存路径。

```bash
:w /root/a.txt
```

- `q`：退出vim
- `qw`：保存并退出
- `q!`：强制退出(如果文件没有被保存是不会保存的)

- `!`：执行`linux命令`

```bash
# 查看当前文件路径
:! pwd
```

- `/查找的内容`

```bash
# 查找文件中的i
/i
```
在查找模式下，按`n`可以使光标移动到下一个`i`的位置。按`shift+n`可以使光标移动到上一个`i`的位置。

- `:s/旧的内容/新的内容`

通过上面的格式可以进行文本的替换

```bash
# 将文件中每一行的第一个的i替换成I
:%s/i/I
```

> `%s`是对整个文件所有行进行查找和替换，`s`默认对光标所在行进行替换。但是它们默认只替换每行的第一个匹配的字符

```bash
# 将文件中所有的i替换成I
:%s/i/I/g
```

- `start,ends/旧的内容/新的内容`

上面对指定行的内容进行替换

```bash
# 将第二行-第四行所有的I替换成i
:2,4s/I/i/g
```

- `set nu`：显示行号
- `set nonu`：取消行号

> `set`命令只对当前修改生效，文件保存退出再次打开后，上面的设置就不生效了。如果你相对`vim`打开的文件都生效，可以设置`/etc/vimrc`相关内容

比如将`set nu`添加到`/etc/vimrc`文件中，则每次使用`vim`打开文件的时候都会显示行号。

## 可视模式

三种进入可视模式的方式

- `v`：字符可视模式
- `V`：行可视模式
- `ctrl+v`：块可视模式
    - 配合`d`和`I`可以命令可以进行块的便利操作

比如在每一行的行首添加`123`。可以按照如下操作：首先进入可视模式，移动光标选择需要添加`123`的行，使用`shift+i`(`I`)命令进入可视编辑模式，输入`123`后，连续按下两次`esc`，就会在选中的行的行首添加`123`。

在可视模式下，选中块后，使用`d`键，可以将选中的块进行删除。