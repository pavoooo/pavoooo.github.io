(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{171:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[n("h1",[s._v("axios揭密--axios是怎么取消请求的")]),s._v(" "),n("p"),s._m(0),n("p"),s._v(" "),n("p",[n("code",[s._v("axios")]),s._v("可以使用"),n("code",[s._v("cancel token")]),s._v("来取消一个请求。详细的使用文档可以参考"),n("a",{attrs:{href:"https://github.com/axios/axios#cancellation",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/axios/axios#cancellation"),n("OutboundLink")],1),s._v("。下面我们主要看一下这个功能是怎么实现的。")]),s._v(" "),s._m(1),s._v(" "),s._m(2),s._m(3),s._v(" "),s._m(4),s._v(" "),n("p",[s._v("但是，这里对请求的取消并不一定真是取消。具体的情况，我们后面会讨论。")]),s._v(" "),s._m(5),s._v(" "),s._m(6),s._m(7),s._v(" "),s._m(8),s._m(9),s._v(" "),s._m(10),s._v(" "),s._m(11),s._v(" "),s._m(12),s._m(13),s._v(" "),s._m(14),s._v(" "),s._m(15),s._v(" "),s._m(16),s._m(17),s._v(" "),s._m(18),s._m(19),s._v(" "),s._m(20),s._v(" "),s._m(21),s._v(" "),s._m(22),s._m(23),s._v(" "),s._m(24),s._v(" "),n("p",[s._v("那如果请求被发送了，我们取消了请求怎么办呢？从这段代码中也能看到")]),s._v(" "),s._m(25),s._m(26),s._v(" "),s._m(27),s._v(" "),s._m(28)])},[function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"table-of-contents"},[t("ul")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("下面是一个使用"),t("code",[this._v("cancel token")]),this._v("取消请求的一个例子")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" axios "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'axios'")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" CancelToken "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" axios"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CancelToken\n"),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" source "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" CancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("source")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\naxios"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("get")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'https://www.baidu.com'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" source"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("token\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nsource"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("cancel")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("所以，使用"),t("code",[this._v("cancel token")]),this._v("取消一个请求一般需要通过如下步骤")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ul",[n("li",[s._v("获取"),n("code",[s._v("CancelToken")]),s._v("函数，该函数是"),n("code",[s._v("axios.CancelToken")]),s._v("上的方法")]),s._v(" "),n("li",[s._v("调用"),n("code",[s._v("CancelToken")]),s._v("的静态方法"),n("code",[s._v("CancelToken.source")]),s._v("获取"),n("code",[s._v("cancel token")])]),s._v(" "),n("li",[s._v("将"),n("code",[s._v("source.token")]),s._v("设置为"),n("code",[s._v("axios")]),s._v("请求对象的"),n("code",[s._v("cancelToken")]),s._v("属性")]),s._v(" "),n("li",[s._v("在需要的时候调用"),n("code",[s._v("source.cancel")]),s._v("方法取消请求")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("首先我们来看"),t("code",[this._v("CancelToken")]),this._v("是怎么实现的，在"),t("code",[this._v("lib/cancel/CancelToken.js")]),this._v("文件中")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("CancelToken")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("executor"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" executor "),n("span",{attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'function'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("TypeError")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'executor must be a function.'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" resolvePromise"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("promise "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Promise")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("promiseExecutor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resolve"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    resolvePromise "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" resolve"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" token "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token function"}},[s._v("executor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("cancel")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("token"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token comment"}},[s._v("// Cancellation has already been requested")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    token"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reason "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Cancel")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("resolvePromise")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("token"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nCancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[s._v("throwIfRequested")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("throwIfRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nCancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[s._v("source")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("source")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" cancel"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" token "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("CancelToken")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("executor")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cancel "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    token"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" token"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    cancel"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cancel\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" CancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("p",[n("code",[s._v("CancelToken")]),s._v("是一个构造函数。当我们调用"),n("code",[s._v("CancelToken.source()")]),s._v("方法的时候，会在其内部初始化一个"),n("code",[s._v("CancelToken")]),s._v("对象。从"),n("code",[s._v("CancelToken.source()")]),s._v("方法中我们也可以看出来")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("token "),n("span",{attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("CancelToken")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// true")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("CancelToken")]),this._v("被调用的时候需要传递一个参数，该参数必须是一个函数。这个函数被调用的时候，也会传递一个参数，这个参数就是用来取消请求的。")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("p",[s._v("所以，当调用"),n("code",[s._v("CancelToken.source()")]),s._v("方法的时候返回值"),n("code",[s._v("token")]),s._v("和"),n("code",[s._v("cancel")]),s._v("分别是"),n("code",[s._v("CancelToken")]),s._v("的实例对象和调用"),n("code",[s._v("CancelToken")]),s._v("实例化对象的时候传递给"),n("code",[s._v("executor")]),s._v("的那个参数函数。")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("p",[n("code",[s._v("CancelToken")]),s._v("被实例化的时候会在其实例对象上创建一个"),n("code",[s._v("promise")]),s._v("属性。从"),n("code",[s._v("CancelToken")]),s._v("的代码中也能看到只有当传递给"),n("code",[s._v("executor")]),s._v("扽那个函数，即"),n("code",[s._v("cancel")]),s._v("函数被调用的时候这个"),n("code",[s._v("promise")]),s._v("才会从"),n("code",[s._v("pending")]),s._v("状态变为"),n("code",[s._v("resolved")]),s._v("状态。而且当"),n("code",[s._v("cancel")]),s._v("函数被调用的时候，也会在"),n("code",[s._v("token")]),s._v("上添加一个"),n("code",[s._v("reason")]),s._v("属性，其是"),n("code",[s._v("Cancel")]),s._v("的实例对象。我们来看看"),n("code",[s._v("Cancel")]),s._v("是怎么实现的，在"),n("code",[s._v("lib/cancel/Cancel.js")]),s._v("文件中")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("Cancel")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" message"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nCancel"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[s._v("toString")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("toString")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'Cancel'")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message "),n("span",{attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("': '")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("this")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message "),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("''")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nCancel"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__CANCEL__ "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" Cancel"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("p",[n("code",[s._v("Cancel")]),s._v("构造函数的实现也很简单，"),n("code",[s._v("message")]),s._v("属性用来显示请求被"),n("code",[s._v("cancel")]),s._v("的原因。"),n("code",[s._v("__CANCEL__")]),s._v("就是用来标志这次请求是否被取消了。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("上面是对"),t("code",[this._v("CancelToken")]),this._v("整个创建流程的一个简单介绍。那取消请求的流程又是什么样的呢，我们来看一下。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("让我们回到之前讲过的"),t("code",[this._v("dispatchRequest")]),this._v("方法中，该方法有下面一些判断。在"),t("code",[this._v("lib/core/dispatchRequest.js")]),this._v("文件中，")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("throwIfCancellationRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    config"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("throwIfRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("dispatchRequest")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("throwIfCancellationRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 省略一些核心代码")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("adapter")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("then")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("onAdapterResolution")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("throwIfCancellationRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("onAdapterRejection")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("!")]),n("span",{attrs:{class:"token function"}},[s._v("isCancel")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{attrs:{class:"token function"}},[s._v("throwIfCancellationRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{attrs:{class:"token comment"}},[s._v("// Transform response data")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reason "),n("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("transformData")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("headers"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                config"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transformResponse\n                "),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Promise"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("reject")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("p",[s._v("在调用"),n("code",[s._v("dispatchRequest")]),s._v("最前面先调用"),n("code",[s._v("throwIfCancellationRequested")]),s._v("函数，这个函数内部会调用"),n("code",[s._v("config.cancelToken.throwIfRequested")]),s._v("方法，其中"),n("code",[s._v("config.cancelToken")]),s._v("就是我们自己传递的"),n("code",[s._v("token")]),s._v("，它的"),n("code",[s._v("throwIfRequested")]),s._v("方法就是判断其属性"),n("code",[s._v("reason")]),s._v("是否存在，因为只有调用了"),n("code",[s._v("cancel")]),s._v("函数，才会在"),n("code",[s._v("token")]),s._v("上添加"),n("code",[s._v("reason")]),s._v("属性。所以就可以认为这个属性如果存在的化，就认为这个请求已经被取消了。比如下面的代码")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" axios "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("require")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'axios'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" CancelToken "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" axios"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CancelToken\n"),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" source "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" CancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("source")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\naxios"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("get")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'https://www.baidu.com'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" source"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("token\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token keyword"}},[s._v("catch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nsource"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("cancel")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'cancel token'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("当"),t("code",[this._v("dispatchRequest")]),this._v("函数被调用的时候，已经调用了"),t("code",[this._v("source.cancel()")]),this._v("方法取消了请求。所以请求是不会被发送的。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("在主线程最初执行的时候，dispatchRequest被添加到了微任务队列中，所以我们可以在通过source.cancel()在它被调用之前取消请求")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("p",[s._v("那如果在这个函数调用后，"),n("code",[s._v("adapter")]),s._v("调用前我们取消了请求，又怎么处理呢？那我们就来看下"),n("code",[s._v("adapter")]),s._v("中是怎么处理的。我们就看一下浏览器端的"),n("code",[s._v("adapter")]),s._v("吧，在"),n("code",[s._v("lib/adapter/xhr.js")]),s._v("文件中。在这个文件中有下面一段代码")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("module"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("xhrAdapter")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Promise")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("dispatchXhrRequest")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resolve"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" reject"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token comment"}},[s._v("// 省略一些核心代码")]),s._v("\n\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token comment"}},[s._v("// Handle cancellation")]),s._v("\n        config"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cancelToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("promise"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("then")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("onCanceled")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cancel"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("request"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n            request"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("abort")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{attrs:{class:"token function"}},[s._v("reject")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cancel"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{attrs:{class:"token comment"}},[s._v("// Clean up request")]),s._v("\n            request "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("null")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 省略一些核心代码  ")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("p",[s._v("如果我们传递了"),n("code",[s._v("config.cancelToken")]),s._v("，那么在发送请求前先判断"),n("code",[s._v("config.cancelToken.promise")]),s._v("是否已经被"),n("code",[s._v("resolved")]),s._v("了。如果被"),n("code",[s._v("resolved")]),s._v("，就说明我们已经调用了"),n("code",[s._v("cancel")]),s._v("函数取消了这次请求。那么就会走"),n("code",[s._v("then")]),s._v("回调，并调用"),n("code",[s._v("request.abort()")]),s._v("方法终止请求。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("上面这种情况感觉你只能在transformData中取消请求了")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("module"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("dispatchRequest")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("throwIfCancellationRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 省略一些核心代码")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("adapter")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("then")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("onAdapterResolution")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token function"}},[s._v("throwIfCancellationRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("onAdapterRejection")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("!")]),n("span",{attrs:{class:"token function"}},[s._v("isCancel")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{attrs:{class:"token function"}},[s._v("throwIfCancellationRequested")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Promise"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("reject")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reason"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("在请求被响应后其实也是会对这次请求是否被取消做判断的，如果本次请求被取消了，同样是会"),t("code",[this._v("throw")]),this._v("出取消原因的。所以，"),t("code",[this._v("axios")]),this._v("做了很严谨的兜底方案。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("这种情况估计你只能在自己的adapter去取消请求了吧")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("p",[s._v("上面是对"),n("code",[s._v("axios")]),s._v("怎么取消请求的做了一个简单的分析。你应该知道"),n("code",[s._v("axios")]),s._v("在请求被发送前是真的能取消发送请求的，一旦请求被发送，"),n("code",[s._v("axios")]),s._v("是无法终止这次连接的，它只能在请求被响应后，不会把真实的响应数据返回给你，而是把相关的取消请求信息"),n("code",[s._v("throw")]),s._v("给你。")])}],!1,null,null,null);e.options.__file="axios揭密--axios是怎么取消请求的.md";t.default=e.exports}}]);