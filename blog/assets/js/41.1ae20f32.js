(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{182:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",[s._v("Nginx学习之路-静态资源服务_代理_负载均衡")]),s._v(" "),s._m(0),s._v(" "),s._m(1),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),s._m(4),s._v(" "),s._m(5),s._v(" "),s._m(6),s._v(" "),s._m(7),s._v(" "),s._m(8),s._v(" "),s._m(9),s._m(10),s._v(" "),s._m(11),s._v(" "),s._m(12),s._m(13),s._v(" "),s._m(14),s._v(" "),s._m(15),s._v(" "),s._m(16),s._m(17),s._v(" "),s._m(18),s._v(" "),s._m(19),s._v(" "),s._m(20),s._m(21),s._v(" "),s._m(22),s._v(" "),s._m(23),s._m(24),s._v(" "),s._m(25),s._m(26),s._v(" "),s._m(27),s._m(28),s._v(" "),s._m(29),s._m(30),s._v(" "),a("p",[a("code",[s._v("http缓存")]),s._v("是提升网站性能最有效的手段之一。想了解更多关于缓存的知识，可以参考我的文章"),a("a",{attrs:{href:"https://zhaosaisai.com/blog/2018/%E7%BC%93%E5%AD%98%E9%82%A3%E4%BA%9B%E4%BA%8B.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("缓存那些事"),a("OutboundLink")],1),s._v("。")]),s._v(" "),s._m(31),s._v(" "),s._m(32),s._m(33),s._v(" "),s._m(34),s._m(35),s._v(" "),s._m(36),s._v(" "),s._m(37),s._m(38),s._v(" "),a("p",[s._v("下面是和跨站资源共享相关的两个配置")]),s._v(" "),s._m(39),a("p",[s._v("允许所有站点的跨站访问")]),s._v(" "),s._m(40),s._m(41),s._v(" "),s._m(42),s._v(" "),s._m(43),s._m(44),s._v(" "),a("p",[s._v("下面是对图片资源防盗链的一个配置规则")]),s._v(" "),s._m(45),a("p",[s._v("当然你也可以通过正则表达式来设置合法或者非法的域名或者ip")]),s._v(" "),s._m(46),s._m(47),s._v(" "),s._m(48),s._v(" "),s._m(49),s._v(" "),s._m(50),s._v(" "),s._m(51),s._v(" "),s._m(52),s._v(" "),a("p",[s._v("正向代理和反向代理的\b区别就是代理的对象不一样。正向代理的代理对象是客户端，反向代理代理对象是服务端。")]),s._v(" "),s._m(53),s._v(" "),s._m(54),s._v(" "),s._m(55),s._m(56),s._v(" "),s._m(57),s._v(" "),s._m(58),s._m(59),s._v(" "),s._m(60),s._m(61),s._v(" "),s._m(62),s._v(" "),s._m(63),s._v(" "),s._m(64),s._v(" "),s._m(65),s._m(66),s._v(" "),s._m(67),s._v(" "),s._m(68),s._m(69),s._v(" "),s._m(70),s._v(" "),s._m(71),s._m(72),s._v(" "),s._m(73),s._v(" "),s._m(74),a("p",[s._v("设置连接超时(nginx连接后端服务的时间)")]),s._v(" "),s._m(75),s._v(" "),s._m(76),s._m(77),s._v(" "),s._m(78),s._v(" "),s._m(79),s._v(" "),s._m(80),s._v(" "),s._m(81),s._v(" "),s._m(82),s._v(" "),s._m(83),s._m(84),s._v(" "),s._m(85),s._v(" "),s._m(86),s._m(87),s._v(" "),s._m(88),s._v(" "),s._m(89),s._v(" "),s._m(90),s._v(" "),s._m(91),s._v(" "),s._m(92),s._m(93),s._v(" "),s._m(94),s._m(95),s._v(" "),s._m(96),a("p",[s._v("上面三个服务(8001, 8002, 8003)是作为内部服务存在，外部无法直接访问。")]),s._v(" "),s._m(97),s._v(" "),s._m(98),s._m(99),s._v(" "),s._m(100),s._v(" "),s._m(101),s._v(" "),s._m(102),s._m(103),s._v(" "),s._m(104),s._m(105),s._v(" "),s._m(106),s._v(" "),s._m(107),s._m(108),s._m(109),s._v(" "),s._m(110),s._v(" "),s._m(111),s._v(" "),s._m(112),s._v(" "),s._m(113),s._m(114),s._v(" "),s._m(115),s._m(116),s._v(" "),s._m(117),s._v(" "),s._m(118),s._m(119),s._v(" "),s._m(120),s._v(" "),s._m(121),s._m(122),s._v(" "),s._m(123)])},[function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("在第一篇中主要学习了关于"),t("code",[this._v("Nginx")]),this._v("中的一些基本语法。接下来需要学习一些"),t("code",[this._v("Nginx")]),this._v("的常见应用。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"静态资源服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#静态资源服务","aria-hidden":"true"}},[this._v("#")]),this._v(" 静态资源服务")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("提供静态资源服务是"),t("code",[this._v("Nginx")]),this._v("最基本的一个功能。静态资源就是指那些不需要服务器程序动态运行生成的文件，比如图片，文本文件等。下面是使用"),t("code",[this._v("Nginx")]),this._v("提供静态服务最常见的一种模式。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"/blog/static_resource.png",alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("除了使用本机文件系统提供静态资源服务外，"),t("code",[this._v("cdn")]),this._v("也是最常见的使用"),t("code",[this._v("Nginx")]),this._v("提供静态资源服务的一种方式。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"/blog/cdn.png",alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("对于静态资源服务的配置，"),t("code",[this._v("Nginx")]),this._v("涉及到很多相关的指令。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("sendfile")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[s._v("开启"),a("code",[s._v("sendfile")]),s._v("功能。"),a("code",[s._v("sendfile")]),s._v("功能可以提供"),a("code",[s._v("Nginx")]),s._v("静态资源的托管效率。"),a("code",[s._v("sendfile")]),s._v("是一个系统调用，直接在内核中完成文件发送，不需要先"),a("code",[s._v("read")]),s._v("再"),a("code",[s._v("write")]),s._v("，没有上下文切换的开销。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v(" on "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("tcp_nopush")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("在"),t("code",[this._v("sendfile")]),this._v("指令开启的情况下，开启"),t("code",[this._v("tcp_nopush")]),this._v("。启用了这个指令后，数据包会被累积到一定大小才发送，减少额外的开销，提升了网络效率。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("tcp_nopush")]),s._v(" on "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("tcp_nopush")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("这个指令只有在"),t("code",[this._v("sendfile")]),this._v("为"),t("code",[this._v("on")]),this._v("的时候才起作用")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("tcp_nodelay")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[s._v("这个指令的目的就是尽快发送数据。"),a("code",[s._v("Nginx")]),s._v("只会针对"),a("code",[s._v("keep-alive")]),s._v("状态的"),a("code",[s._v("TCP")]),s._v("连接启用"),a("code",[s._v("tcp_nodelay")]),s._v("。"),a("code",[s._v("tcp_nopush")]),s._v("和"),a("code",[s._v("tcp_nodelay")]),s._v("结合在一起使用的时候，会先填满包，然后再尽快发送。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("tcp_nodelay")]),s._v(" on "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("tcp_nodelay")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("gzip")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"/blog/gzip.png",alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("一般在项目上线前，我们都会对代码(html, css, js)等进行压缩，图片也会压缩。对于文本文件，我们在服务端发送响应之前开启"),t("code",[this._v("gzip")]),this._v("压缩。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" on "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("在"),t("code",[this._v("gzip")]),this._v("指令开启的情况下，有很多其它辅助的指令对压缩的特性进行设置。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("设置压缩比")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" level"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("设置在哪个版本的http协议下才会对资源进行压缩")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1.0")]),a("span",{attrs:{class:"token operator"}},[s._v("|")]),a("span",{attrs:{class:"token number"}},[s._v("1.1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1.1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("我们也可以使用"),t("code",[this._v("http_gzip_static_module")]),this._v("模块来开启预读"),t("code",[this._v("gzip")]),this._v("数据的功能。这个模块就是在获取资源的时候预先读取被压缩的资源，如果压缩资源存在，直接读取。否则就读取源文件然后压缩返回。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_static")]),s._v(" on "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("上面是"),t("code",[this._v("Nginx")]),this._v("作为静态资源服务时候的一些配置，下面是一份"),t("code",[this._v("Nginx")]),this._v("作为静态资源服务时候的配置文件。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{attrs:{class:"token number"}},[s._v("80")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 开启sendfie指令")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 视情况开启下面两个指令")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# tcp_nopush on;")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# tcp_nodelay on;")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 配置一些关于静态文件读取的规则")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 如果获取的文件是以 .png .gif .jeg 结尾的资源，通过如下指令进行处理")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jpg"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$  "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 放置图片的地方")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 是否开启gzip压缩")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# gzip的http协议的版本")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1.1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 压缩等级")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v(" text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("plain application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("javascript text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("css application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("xml text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("httpd"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("php image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("jpeg image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("gif image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("png"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("txt"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("xml"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$  "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 放置文本文件的地方")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("doc"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 是否开启gzip压缩")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# gzip的http协议的版本")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1.1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 压缩等级")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v(" text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("plain application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("javascript text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("css application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("xm\nl text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("httpd"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("php image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("jpeg image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("gif image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("png"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 如果是下载资源")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("^")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("download  "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 放置下载资源的地方")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 预先读取压缩文件")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_static")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 开启 tcp_nopush")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("tcp_nopush")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存","aria-hidden":"true"}},[this._v("#")]),this._v(" 缓存")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[a("code",[s._v("Nginx")]),s._v("是通过"),a("code",[s._v("expires")]),s._v("指令来控制缓存行为的。"),a("code",[s._v("expires")]),s._v("指令的原理就是添加"),a("code",[s._v("cache-control")]),s._v("，"),a("code",[s._v("expires")]),s._v("头部。配置语法如下：")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("modified"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" time"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("time")]),this._v("就是用来指定缓存过期的时间。比如，我们对"),t("code",[this._v("html")]),this._v("文件设置的缓存时间为"),t("code",[this._v("24h")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("htm"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("html"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 对html文件设置过期时间")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("24")]),s._v("h"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"跨站资源共享"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#跨站资源共享","aria-hidden":"true"}},[this._v("#")]),this._v(" 跨站资源共享")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("Nginx")]),this._v("可以通过"),t("code",[this._v("add_header")]),this._v("指令添加允许跨站资源共享的头部。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" name value "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("always"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ul",[a("li",[a("strong",[s._v("name")]),s._v("：就是和跨站访问有关的头部")]),s._v(" "),a("li",[a("strong",[s._v("value")]),s._v("：就是允许的站点的名称")]),s._v(" "),a("li",[a("strong",[s._v("always")]),s._v("：表示对全部站点允许")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("htm"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("html"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token keyword"}},[s._v("Allow")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Origin "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("zhaosaisai"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token keyword"}},[s._v("Allow")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Method GET"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("POST"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("PUT"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("DELETE"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("OPTIONS"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("htm"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("html"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token keyword"}},[s._v("Allow")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Origin "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token keyword"}},[s._v("Allow")]),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Method GET"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("POST"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("PUT"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("DELETE"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("OPTIONS"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"防盗链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防盗链","aria-hidden":"true"}},[this._v("#")]),this._v(" 防盗链")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("防盗链的目的就是防止资源被盗用。防盗链设置思路，首要方式就是区别哪些请求是非正常的用户请求。在"),t("code",[this._v("Nginx")]),this._v("中我们可以使用"),t("code",[this._v("http_refer")]),this._v("模块来配置防盗链规则。语法如下")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" none "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" blocked "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_names "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" string"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v("\nontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ul",[a("li",[a("strong",[s._v("none")]),s._v("：表示允许没有带"),a("code",[s._v("referer")]),s._v("的请求")]),s._v(" "),a("li",[a("strong",[s._v("blocked")]),s._v("：表示允许"),a("code",[s._v("referer")]),s._v("信息不携带协议，比如不带"),a("code",[s._v("http")]),s._v("或者"),a("code",[s._v("https")]),s._v("协议等")]),s._v(" "),a("li",[a("strong",[s._v("server_names")]),s._v("：表示允许的域名或者ip。")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jpg"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$  "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 放置图片的地方")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 是否开启gzip压缩")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# gzip的http协议的版本")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1.1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 压缩等级")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v(" text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("plain application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("javascript text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("css application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("xml text"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript application"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("httpd"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("php image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("jpeg image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("gif image"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("png"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 防盗链设置")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" none blocked "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 通过内置变量$invalid_referer来判断是否有一些referer被阻止")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$invalid_referer")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("403")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("valid_referers")]),s._v(" none blocked "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("google\\"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代理","aria-hidden":"true"}},[this._v("#")]),this._v(" 代理")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("作为代理服务器也是"),t("code",[this._v("Nginx")]),this._v("的一种常见用途。代理分为两种：正向代理和反向代理。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("正向代理")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"/blog/zxdl.png",alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("反向代理")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"/blog/fxdl.png",alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"nginx代理配置语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx代理配置语法","aria-hidden":"true"}},[this._v("#")]),this._v(" Nginx代理配置语法")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("Nginx配置代理主要是通过"),t("code",[this._v("proxy_pass")]),this._v("指令声明，语法如下：")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" url"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" in "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("limit_except")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("下面是"),t("code",[this._v("Nginx")]),this._v("配置的一个反向代理的配置文件")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("配置一：外部可以访问的端口配置")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{attrs:{class:"token number"}},[s._v("80")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("#charset koi8-r;")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("#access_log  /var/log/nginx/host.access.log  main;")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("share"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\t"),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("test_proxy"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html$ "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 访问test_proxy.html页面的时候，通过代理服务转到本机8080端口上。本机的8080端口外部是无法直接访问的")]),s._v("\n\t\t"),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token number"}},[s._v("127.0")]),a("span",{attrs:{class:"token number"}},[s._v(".0")]),a("span",{attrs:{class:"token number"}},[s._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8080")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("配置二：配置8080端口的访问")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{attrs:{class:"token number"}},[s._v("8080")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 8080\b服务的根目录")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code2"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("当我们访问"),t("code",[this._v("http://192.168.144.129/test_proxy.html")]),this._v("的时候，在服务器的内部会将我们的请求转发给本机"),t("code",[this._v("8080")]),this._v("端口所在的服务。这里用户实际看到的是"),t("code",[this._v("/opt/app/code2/test_proxy.html")]),this._v("。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("正向代理的转发并不在服务端，着重的是对客户端的配置。")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("proxy_pass")]),this._v("是"),t("code",[this._v("Nginx")]),this._v("配置代理最基本的指令。除此，还有一些其它的指令在配置代理的过程中生效。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("proxy_buffering")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_buffering")]),s._v(" on "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_buffering")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[a("code",[s._v("proxy_buffering")]),s._v("这个指令打开后会尽可能的将一个请求的数据收集完一次性的返回给客户端。这个指令起到了缓冲区的作用。当这个指令打开后，数据默认保存在内存中，对于缓冲区的大小，可以通过下面几个配置修改"),a("code",[s._v("proxy_buffer_size")]),s._v(", "),a("code",[s._v("proxy_buffers")]),s._v(", "),a("code",[s._v("proxy_busy_buffers_size")]),s._v("。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("proxy_redirect")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" default"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" redirect replacement"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" default"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[a("code",[s._v("proxy_redirect")]),s._v("这个指令的作用就是当我们使用"),a("code",[s._v("nginx")]),s._v("作为代理服务器的时候，代理后端的服务返回的是一个重定向。比如301的时候，"),a("code",[s._v("nginx")]),s._v("就会把我们的请求重定向到指定的"),a("code",[s._v("url")]),s._v("然后返回给客户端。这种场景多用在后端返回的重定向地址是前端无法直接访问到的时候，或者需要对重定向地址进行重写的时候使用。一般使用默认配置"),a("code",[s._v("default")]),s._v("即可。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("proxy_set_header")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" field value"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{attrs:{class:"token variable"}},[s._v("$proxy_host")]),s._v("\n         "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection close\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("Nginx")]),this._v("代理服务器将请求转发给后端的时候，添加头部信息给后端服务器。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("strong",[this._v("proxy_connect_timeout")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v(" time"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("60")]),s._v("s"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("一个Nginx作为代理服务器时的配置文件")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token number"}},[s._v("127.0")]),a("span",{attrs:{class:"token number"}},[s._v(".0")]),a("span",{attrs:{class:"token number"}},[s._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8080")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" default"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("# 一般设置为默认")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# nginx访问后端服务的时候的头部信息")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{attrs:{class:"token variable"}},[s._v("$http_host")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  proxy_set header X"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),a("span",{attrs:{class:"token variable"}},[s._v("$remote_addr")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# 设置超时时间")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("30")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("60")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("60")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# 设置缓冲区")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_buffering")]),s._v(" on"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_buffer_size")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("32")]),s._v("k"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_buffers")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("128")]),s._v("k"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_busy_buffers_size")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("256")]),s._v("k"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_max_temp_file_size")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("256")]),s._v("k"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"负载均衡服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡服务","aria-hidden":"true"}},[this._v("#")]),this._v(" 负载均衡服务")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("Nginx")]),this._v("作为负载均衡服务器也是"),t("code",[this._v("Nginx")]),this._v("最主要的用途之一。下图是对"),t("code",[this._v("Nginx")]),this._v("作为负载均衡服务器的一个简单概括")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"/blog/fzjh1.png",alt:""}})])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[a("code",[s._v("Nginx")]),s._v("实现负载均衡服务器主要是通过"),a("code",[s._v("proxy_pass")]),s._v("指令和"),a("code",[s._v("upstream")]),s._v("配置来实现。"),a("code",[s._v("proxy_pass")]),s._v("用于将请求转发给上游服务器。"),a("code",[s._v("upstream")]),s._v("用来定义上游服务器集。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("upstream是配置只能在http块中，不能配置在server或者location块中。")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("下面是"),t("code",[this._v("upstream")]),this._v("的配置语法")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" name "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"upstream配置讲解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#upstream配置讲解","aria-hidden":"true"}},[this._v("#")]),this._v(" upstream配置讲解")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("下面我们详细的了解一下怎么去配置"),t("code",[this._v("upstream")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" 虚拟服务的名称 "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# 内部是对应的每一个server")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# server后面可以是对应的域名，也可以是\b具体的ip地址")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# weight表示的是权重，权重越大，被轮询的概率就越大")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" backend1"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com weight"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("5")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" backend2"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8080")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# 也可以是socket")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" unix"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("backend3"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# 后面的backup表示的是负载均衡服务器在调度中的状态")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" backend1"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8080")]),s._v(" backup"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" backend2"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8080")]),s._v(" backup"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("负载均衡服务器在调度中的状态")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ul",[a("li",[a("strong",[s._v("down")]),s._v("：当前的server暂时不参与负载均衡")]),s._v(" "),a("li",[a("strong",[s._v("backup")]),s._v("：预留的备份服务器，其它的服务器不可用的时候会访问。")]),s._v(" "),a("li",[a("strong",[s._v("max_fails")]),s._v("：允许请求失败的次数")]),s._v(" "),a("li",[a("strong",[s._v("fail_timeout")]),s._v("：经过max_fails后，服务暂停的时间")]),s._v(" "),a("li",[a("strong",[s._v("max_conns")]),s._v("：\b限制最大的接收连接数")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("为了能够快速理解负载均衡服务的配置，我们先用"),t("code",[this._v("Nginx")]),this._v("实现一个简单的负载均衡")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("首先配置三台上游服务器")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ol",[t("li",[t("strong",[this._v("server1.conf")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{attrs:{class:"token number"}},[s._v("8001")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code1"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ol",{attrs:{start:"2"}},[t("li",[t("strong",[this._v("server2.conf")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{attrs:{class:"token number"}},[s._v("8002")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code2"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ol",{attrs:{start:"3"}},[t("li",[t("strong",[this._v("server3.conf")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{attrs:{class:"token number"}},[s._v("8003")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("code3"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),a("span",{attrs:{class:"token keyword"}},[s._v("index")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("上游服务器配置好后，配置自己的服务器负载均衡到这三台服务器中")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" saisai "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8001")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8002")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8003")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{attrs:{class:"token number"}},[s._v("80")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token comment"}},[s._v("# \b代理到upstream模块中的server上")]),s._v("\n      "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("saisai"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("当我们访问"),t("code",[this._v("http://192.168.144.129/")]),this._v("会看到我们的请求会周期性的返回三台服务器中的内容。这是由"),t("code",[this._v("Nginx")]),this._v("内部的调度算法决定的。调度算法主要有如下几种")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"调度算法配置方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调度算法配置方式","aria-hidden":"true"}},[this._v("#")]),this._v(" 调度算法配置方式")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"ip-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ip-hash","aria-hidden":"true"}},[this._v("#")]),this._v(" ip_hash")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" saisai "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("ip_hash")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8001")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8002")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8003")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"加权轮询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加权轮询","aria-hidden":"true"}},[this._v("#")]),this._v(" 加权轮询")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" saisai "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8001")]),s._v(" weight"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8002")]),s._v(" weight"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("2")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8003")]),s._v(" weight"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("weight的值越大，访问的几率越大")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"url-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#url-hash","aria-hidden":"true"}},[this._v("#")]),this._v(" url_hash")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hash key "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("consistent"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("upstream")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" saisai "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("# 对请求地址进行hash计算")]),s._v("\n    hash "),a("span",{attrs:{class:"token variable"}},[s._v("$request_uri")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8001")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8002")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8003")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"代理缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代理缓存","aria-hidden":"true"}},[this._v("#")]),this._v(" 代理缓存")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("我们可以通过"),t("code",[this._v("Nginx")]),this._v("设置代理缓存，这样能有有效的减轻后端服务器的负载压力。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("img",{attrs:{src:"/blog/dlhc.png",alt:""}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("代理缓存主要是通过"),t("code",[this._v("proxy_cache")]),this._v("指令配置。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("Syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache")]),s._v(" zone "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache")]),s._v(" off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nContext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("开启代理缓存后，我们还需要使用"),t("code",[this._v("proxy_cache_path")]),this._v("指令定义好一个目录和空间大小用来存放缓存文件。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("Syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache_path")]),s._v(" path "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("levels"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("levels"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("use_temp_path"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("off"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" keys_zone"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("name"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("size "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("inactive"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("max_size"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("size"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("manager_files"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("number"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("manager_sleep"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("manager_threshold"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("loader_files"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("number"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("loader_sleep"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("loader_threshold"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("purger"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("off"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("purger_files"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("number"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("purger_sleep"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("purger_threshold"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("time"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t—\nContext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("key_zone就是在proxy_cache指令中设置的zone的名称")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("除此我们也可以定义缓存的生效时间和系统保存缓存内容时候的"),t("code",[this._v("key")]),this._v("。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache_valid")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("code"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" time"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("\ncontext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("code")]),this._v("就是指返回的状态码，"),t("code",[this._v("time")]),this._v("用来定义过期时间。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("proxy_cache_key")]),this._v("就是用来定义缓存的维度。其实就是缓存的key。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v("Syntax"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache_key")]),s._v(" string"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDefault"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache_key")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$scheme")]),a("span",{attrs:{class:"token variable"}},[s._v("$proxy_host")]),a("span",{attrs:{class:"token variable"}},[s._v("$request_uri")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nContext"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t"),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("下面是"),t("code",[this._v("Nginx")]),this._v("配置代理缓存的一个实际例子")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" saisai "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8001")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8002")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("192.168")]),a("span",{attrs:{class:"token number"}},[s._v(".144")]),a("span",{attrs:{class:"token number"}},[s._v(".129")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("8003")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("# 定义缓存路径")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache_path")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("cache levels"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v(" keys_zone"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("saisai_cache"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token number"}},[s._v("10")]),s._v("m max_size"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("100")]),s._v("m inactive"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("60")]),s._v("m use_temp_path"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("off"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{attrs:{class:"token number"}},[s._v("80")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("http")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("saisai"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache")]),s._v(" saisai_cache"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 200 和 304的响应缓存2小时")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache_valid")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("304")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v("h"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 其它响应缓存10分钟")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache_valid")]),s._v(" any "),a("span",{attrs:{class:"token number"}},[s._v("10")]),s._v("m"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("proxy_cache_key")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$host")]),a("span",{attrs:{class:"token variable"}},[s._v("$uri")]),a("span",{attrs:{class:"token variable"}},[s._v("$is_args")]),a("span",{attrs:{class:"token variable"}},[s._v("$args")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Nginx"),a("span",{attrs:{class:"token operator"}},[s._v("-")]),s._v("Cache "),a("span",{attrs:{class:"token string"}},[s._v('"$upstream_cache_status"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 定义重试机制")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 下面的配置就表示在 error timeout invalid_header http_500 http_502 http_503 http_504的响应下")]),s._v("\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 将请求重新发送到下一个上游服务器进行重试操作")]),s._v("\n        proxy_next_stream error "),a("span",{attrs:{class:"token keyword"}},[s._v("timeout")]),s._v(" invalid_header http_500 http_502 http_503 http_504"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])])}],!1,null,null,null);e.options.__file="Nginx学习-静态资源服务_代理_负载均衡.md";t.default=e.exports}}]);