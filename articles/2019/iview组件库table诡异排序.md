# iviewç»„ä»¶åº“tableè¯¡å¼‚æ’åº

å‰å‡ å¤©ï¼Œè€å¤§åé¦ˆè¯´æ¸ é“è¥é”€åå°çš„è¡¨æ ¼æ’åºå¾ˆè¯¡å¼‚ï¼Œåˆ°åº•ä»€ä¹ˆè¯¡å¼‚çš„ç°è±¡å‘¢ï¼Ÿè¿™é‡Œå…ˆæ¥çœ‹ä¸€ä¸‹

- æ— æ’åºæ­£å¸¸æ•ˆæœ

![](/blog/iview1.png)

- â€ç™»å½•æˆæœ¬â€œ é™åºæ’åˆ—

![](/blog/iview2.png)

- â€œç™»å½•æˆæœ¬â€ å‡åºæ’åˆ—

![](/blog/iview3.png)

å¾ˆå¥‡æ€ªï¼Œæ— è®ºæ˜¯å‡åºæ’åˆ—è¿˜æ˜¯é™åºæ’åˆ—ï¼Œç™»å½•æˆæœ¬ä¸­çš„ä¸¤ä¸ª`0`è®°å½•éƒ½ä¼šåœ¨ä¸­é—´å‡ºç°ã€‚éš¾é“`iview`çš„è¡¨æ ¼æ’åºå†…éƒ¨åšäº†ä»€ä¹ˆé¢å¤–çš„å¤„ç†å—ï¼Ÿå¸¦ç€è¿™ä¸ªç–‘é—®ï¼Œå»çœ‹ä¸€ä¸‹`iview`çš„`table`ç»„ä»¶æ˜¯æ€ä¹ˆå¤„ç†è¡¨æ ¼æ’åºçš„ï¼Ÿ

`iview`ä¸­çš„è¡¨æ ¼æ’åºæ–¹æ³•é€šè¿‡[tableç»„ä»¶çš„sortData](https://github.com/iview/iview/blob/2.0/src/components/table/table.vue#L680)æ–¹æ³•å®ç°çš„ã€‚ä¸‹é¢æ˜¯å®ƒçš„æºç 

```js
sortData (data, type, index) {
  const key = this.cloneColumns[index].key;
  data.sort((a, b) => {
    if (this.cloneColumns[index].sortMethod) {
      return this.cloneColumns[index].sortMethod(a[key], b[key], type);
    } else {
      if (type === 'asc') {
        return a[key] > b[key] ? 1 : -1;
      } else if (type === 'desc') {
        return a[key] < b[key] ? 1 : -1;
      }
    }
  });
  return data;
}
```

æºç ä¸­å¯¹è¡¨æ ¼æ•°æ®çš„æ’åºå°±æ˜¯é€šè¿‡`Array.prototype.sort`æ–¹æ³•å®ç°çš„ã€‚åœ¨æˆ‘ä»¬çš„è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰è‡ªå®šä¹‰æ’åºæ–¹æ³•`sortMethod`ï¼Œæ‰€ä»¥`sort`çš„å›æ‰å‡½æ•°ä¼šå§‹ç»ˆèµ°`else`åˆ†æ”¯ã€‚åœ¨è¿™ä¸ªåˆ†æ”¯é‡Œï¼Œä¼šæ ¹æ®æˆ‘ä»¬çš„æ’åºæ–¹å¼é€‰æ‹©ä¸åŒçš„åˆ†æ”¯å»å¤„ç†ã€‚ä¸ºäº†éªŒè¯ä¸€ä¸‹è¿™ä¸ªæ’åºæ–¹æ³•çš„å‡†ç¡®æ€§ï¼Œæˆ‘å†™äº†å¦‚ä¸‹ä»£ç 

```js
const array = [27.47, 21.98, 0, 28.27, 20.66, 0, 17.22] // ä¸Šè¿°è¡¨æ ¼ä¸­ç™»å½•æˆæœ¬ æ˜¾ç¤ºçš„æ•°æ®

console.log(
  array.sort((a, b) => {
    return a < b ? 1 : -1
  })
)
```

ç„¶åä½¿ç”¨nodeè¿è¡Œä¸€ä¸‹ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœ

```js
// [ 28.27, 27.47, 21.98, 20.66, 17.22, 0, 0 ]
```

è€Œä¸”å’Œæµè§ˆå™¨ä¸­è¿è¡Œçš„ç»“æœä¸€è‡´ã€‚


å¾ˆæ‡µé€¼ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œæ’åºå‡†ç¡®æ— è¯¯ï¼Œè¡¨æ ¼ä¸­çš„æ’åºé‚£ä¹ˆä¹±å‘¢ï¼Ÿéš¾é“æ˜¯æˆ‘ä»¬çš„æ•°æ®æœ‰é—®é¢˜ï¼Ÿçœ‹äº†ä¸€ä¸‹æ¥å£è¿”å›ï¼Œçªç„¶æ„è¯†è¿‡æ¥ï¼Œæˆ‘ä»¬ç”¨åœ¨è¡¨æ ¼ä¸­æ’åºçš„dataï¼Œå¹¶ä¸æ˜¯ç”±æ•°å­—ç»„æˆçš„æ•°ç»„ï¼Œè€Œæ˜¯å¯¹è±¡æ•°ç»„ã€‚ä¸‹é¢æ˜¯ç²¾ç®€åçš„æ•°æ®

```js
const array = [
  { "name": "åº”ç”¨å•†åº—ç»„", "count": 9494, "cost": 27.47, },
  { "name": "ç²¾å‡†è¥é”€ç»„", "count": 10562, "cost": 21.98, },
  { "name": "å…¶ä»–", "count": 10696, },
  { "name": "å¹¿å‘Šåª’ä½“ç»„", "count": 3148, "cost": 28.27, },
  { "name": "ç¤¾äº¤åª’ä½“ç»„", "count": 1241, "cost": 20.66, },
  { "name": "æ¸ é“åˆä½œ", "count": 148, },
  { "name": "åˆè®¡", "count": 35289, "cost": 17.22, }
]
```

é‚£æˆ‘ä»¬å°±å¯¹è¿™æ®µæ•°æ®ä»¥`cost`(è¡¨æ ¼ä¸­çš„ç™»å½•æˆæœ¬çš„key)çš„å€¼è¿›è¡Œä¸€ä¸ªæ’åºï¼Œ

```js
console.log(
  array.sort((a, b) => {
    return a.cost < b.cost ? 1 : -1
  })
)
```

åœ¨nodejsè¿è¡Œç»“æœå¦‚ä¸‹

```js
[ { name: 'åº”ç”¨å•†åº—ç»„', count: 9494, cost: 27.47 },
  { name: 'ç²¾å‡†è¥é”€ç»„', count: 10562, cost: 21.98 },
  { name: 'å…¶ä»–', count: 10696 },
  { name: 'å¹¿å‘Šåª’ä½“ç»„', count: 3148, cost: 28.27 },
  { name: 'ç¤¾äº¤åª’ä½“ç»„', count: 1241, cost: 20.66 },
  { name: 'æ¸ é“åˆä½œ', count: 148 },
  { name: 'åˆè®¡', count: 35289, cost: 17.22 } ]
```

æœç„¶ï¼Œæ•°æ®å¹¶ä¸æ˜¯ä¸¥æ ¼çš„æŒ‰ç…§`cost`çš„å€¼é™åºæ’åˆ—ã€‚æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿä¸€ä¸‹åŸæ•°æ®ï¼Œä½ ä¼šå‘ç°`name`ä¸º*å…¶å®ƒ*å’Œ*æ¸ é“åˆä½œ*çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶æ²¡æœ‰`cost`å­—æ®µã€‚æ‰€ä»¥ï¼Œè¿™ä¸¤ä¸ªå…ƒç´ ä»¥`cost`åˆ—è¿›è¡Œæ’åºçš„æ—¶å€™ï¼Œå…¶åœ¨`sort`å›æ‰å‡½æ•°ä¸­è·å¾—çš„å€¼æ˜¯`undefined`ã€‚**`undefined`å’Œä»»ä½•å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç»“æœéƒ½ä¸º`false`**ï¼Œå³

```js
undefined > 100 //  false
undefined === 100 // false
undefined < 100 // false
```

æ‰€ä»¥è¿™ä¸¤åˆ—å…ƒç´ åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™`sort`æ–¹æ³•çš„å›æ‰å‡½æ•°è¿”å›å€¼éƒ½æ˜¯`-1`ã€‚è¿‡ç¨‹æ¸…æ¥šäº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¾“å‡ºä¸Šé¢çš„ç»“æœï¼Œè¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚å¸¦ç€ç–‘é—®ï¼Œå°±å»çœ‹çœ‹`Array.prototype.sort`æ–¹æ³•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

ç»æŸ¥èµ„æ–™å¾—çŸ¥ï¼Œ`V8`å¯¹äºæ•°ç»„çš„æ’åºå®ç°äº†ä¸¤ç§æ’åºç®—æ³•ï¼š**æ’å…¥æ’åº**å’Œ**å¿«é€Ÿæ’åº**ã€‚è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨[V8ä»“åº“](https://github.com/v8/v8/blob/6.2.414/src/js/array.js#L718)ä¸­ä¹Ÿèƒ½çœ‹å‡º

> æˆ‘çš„ç‰ˆæœ¬æ˜¯`8.10`å¯¹åº”çš„`v8`ç‰ˆæœ¬æ˜¯`6.2.414.50`

```js
// For short (length <= 10) arrays, insertion sort is used for efficiency.
```

æºç ä¸­æ˜ç¡®è¯´æ˜äº†ï¼Œå½“æ•°ç»„é•¿åº¦å°äº10çš„æ—¶å€™ä½¿ç”¨æ’å…¥æ’åºã€‚ä¸‹é¢æ˜¯`V8`çš„æ’å…¥æ’åºç®—æ³•

```js
function InsertionSort(a, from, to) {
  for (var i = from + 1; i < to; i++) {
    var element = a[i];
    for (var j = i - 1; j >= from; j--) {
      var tmp = a[j];
      var order = comparefn(tmp, element);
      if (order > 0) {
        a[j + 1] = tmp;
      } else {
        break;
      }
    }
    a[j + 1] = element;
  }
};
```

å‚æ•°`a`å°±æ˜¯å¾…æ’åºçš„æ•°ç»„ï¼Œ`from`å°±æ˜¯å¼€å§‹ä½ç½®ï¼Œ`to`å°±æ˜¯ç»“æŸçš„ä½ç½®ã€‚`comparefn`å°±æ˜¯æˆ‘ä»¬ä¼ å…¥ç»™`sort`æ–¹æ³•çš„å›æ‰å‡½æ•°ã€‚å¯¹äºæˆ‘ä»¬è¿™ç§åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®ä½œä¸€ä¸‹æ”¹åŠ¨å°±èƒ½éªŒè¯ç»“æœäº†

```js
const comparefn = (a, b) => {
  return a.cost < b.cost ? 1 : -1
}

function InsertionSort(a, from, to) {
  for (var i = from + 1; i < to; i++) {
    var element = a[i];
    for (var j = i - 1; j >= from; j--) {
      var tmp = a[j];
      var order = comparefn(tmp, element);
      if (order > 0) {
        a[j + 1] = tmp;
      } else {
        break;
      }
    }
    a[j + 1] = element;
  }
};
```

ç„¶åå¯¹æˆ‘ä»¬ä¸Šé¢çš„æ•°ç»„è¿›è¡Œæ’åº

```js
InsertionSort(array, 0, array.length)
```

æœç„¶ï¼Œç»“æœå’Œ`Array.prototype.sort`çš„æ’åºä¸€è‡´

```js
[ { name: 'åº”ç”¨å•†åº—ç»„', count: 9494, cost: 27.47 },
  { name: 'ç²¾å‡†è¥é”€ç»„', count: 10562, cost: 21.98 },
  { name: 'å…¶ä»–', count: 10696 },
  { name: 'å¹¿å‘Šåª’ä½“ç»„', count: 3148, cost: 28.27 },
  { name: 'ç¤¾äº¤åª’ä½“ç»„', count: 1241, cost: 20.66 },
  { name: 'æ¸ é“åˆä½œ', count: 148 },
  { name: 'åˆè®¡', count: 35289, cost: 17.22 } ]
```

ä¸Šé¢æ’åºç®—æ³•å…³é”®ä¹‹å¤„å°±åœ¨äº`order < 0`çš„æ—¶å€™ï¼Œæœ€å†…éƒ¨çš„å¾ªç¯ç›´æ¥`break`äº†ã€‚å›åˆ°ä¸Šé¢æˆ‘ä»¬è¯´çš„`undefined`å’Œä»»ä½•å€¼ç›¸æ¯”è¾ƒéƒ½æ˜¯`false`ï¼Œ`sort`å›æ‰å‡½æ•°çš„è¿”å›å€¼æ°¸è¿œæ˜¯`-1`ã€‚å½“è¿›è¡Œnameæ˜¯`å…¶ä»–`å’Œ`æ¸ é“åˆä½œ`ä¸¤ä¸ªå…ƒç´ çš„æ’åºçš„æ—¶å€™ï¼Œ`InsertionSort`å‡½æ•°å†…éƒ¨çš„ç¬¬äºŒå±‚`for`å¾ªç¯è¿›å»å°±å‡ºæ¥äº†ï¼Œæ‰€ä»¥ï¼Œå¯¹äºè¿™ä¸¤åˆ—è€Œè¨€ï¼Œæ’åºä¹‹åçš„ä½ç½®æ°¸è¿œä¸å˜ã€‚

ä½†æ˜¯ï¼Œè¿˜æ²¡ç»“æŸï¼ŒæŠŠä¸‹é¢çš„ä»£ç åœ¨æµè§ˆå™¨ä¸­è¿è¡Œä¸€ä¸‹

```js
console.log(
  array.sort((a, b) => {
    return a.cost < b.cost ? 1 : -1
  })
)
```

ç»“æœæ˜¯è¿™æ ·çš„

```js
[ { name: 'æ¸ é“åˆä½œ', count: 148 },
  { name: 'å¹¿å‘Šåª’ä½“ç»„', count: 3148, cost: 28.27 },
  { name: 'å…¶ä»–', count: 10696 },
  { name: 'åº”ç”¨å•†åº—ç»„', count: 9494, cost: 27.47 },
  { name: 'ç²¾å‡†è¥é”€ç»„', count: 10562, cost: 21.98 },
  { name: 'ç¤¾äº¤åª’ä½“ç»„', count: 1241, cost: 20.66 },
  { name: 'åˆè®¡', count: 35289, cost: 17.22 } ]
```

è¿™ä¸ªç»“æœå’Œæœ€åˆä¸€æ ·è¡¨æ ¼ä¸­çš„æ’åºç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œå¾ˆå¥‡æ€ªï¼Œéš¾é“æµè§ˆå™¨ç«¯çš„`Array.prototype.sort`æ–¹æ³•ä¸æ˜¯`V8`ä¸­å®ç°çš„å—ï¼Œè¿˜æ˜¯ç‰ˆæœ¬çš„ä¸åŒé€ æˆäº†ç»“æœçš„å·®å¼‚ï¼Ÿ

çœ‹ä¸€ä¸‹æˆ‘çš„`chrome`çš„ç‰ˆæœ¬å§ï¼š`chrome@72.0.3626`ï¼Œå¯¹åº”çš„`V8@7.2.502`ã€‚é‚£å°±åˆ°`V8`çš„ä»“åº“ä¸­çœ‹ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬çš„`sort`æ–¹æ³•çš„å®ç°ã€‚[https://github.com/v8/v8/blob/7.2.502/src/js/array.js#L239](https://github.com/v8/v8/blob/7.2.502/src/js/array.js#L239)

ä½ ä¼šå‘ç°`V8@7.2.502`å’Œ`V8@6.2.414`çš„å®ç°æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œä½†ä¸ºä»€ä¹ˆç»“æœç¡®æ˜¯ä¸ä¸€æ ·çš„å‘¢ï¼Ÿç„¶ååœ¨`V8@7.2.502`å…¨å±€æœç´¢äº†ä¸€ä¸‹`sort`å…³é”®å­—ï¼Œä¹Ÿæ²¡å‘ç°å…¶å®ƒæ’åºæ–¹æ³•çš„å®ç°ã€‚æ—¢ç„¶æ‰¾ä¸åˆ°ï¼Œå°±å¤§èƒ†çŒœæµ‹ä¸€ä¸‹å§---éš¾ä¸æˆ`Chrome`ä½¿ç”¨çš„æ˜¯ **äºŒåˆ†æ’å…¥æ’åº**ï¼Ÿç„¶åï¼Œæ‰’äº†ä¸€æ®µäºŒåˆ†æ’å…¥æ’åºç®—æ³•çš„å®ç°(è®°ä¸ä½å•Šè®°ä¸ä½)

```js
function binaryInsertSort(arr) {
  for (var i = 1; i < arr.length; i++) {
    var key = arr[i],
      left = 0,
      right = i - 1;
    while (left <= right) {
      var middle = parseInt((left + right) / 2);
      if (key.totalLoginCost < arr[middle].totalLoginCost) {
        right = middle - 1;
      } else {
        left = middle + 1;
      }
    }
    for (var j = i - 1; j >= left; j--) {
      arr[j + 1] = arr[j];
    }
    arr[left] = key;
  }
  return arr;
}
```

ç„¶ååœ¨`node`ç«¯è¿è¡Œä¸€ä¸‹

```js
console.log(
  binaryInsertSort(array).reverse()
)
```

> ä¿æŒç»“æœä¸€è‡´ï¼Œ reverseäº†ä¸€ä¸‹

```js
[ { name: 'æ¸ é“åˆä½œ', count: 148 },
  { name: 'å¹¿å‘Šåª’ä½“ç»„', count: 3148, cost: 28.27 },
  { name: 'å…¶ä»–', count: 10696 },
  { name: 'åº”ç”¨å•†åº—ç»„', count: 9494, cost: 27.47 },
  { name: 'ç²¾å‡†è¥é”€ç»„', count: 10562, cost: 21.98 },
  { name: 'ç¤¾äº¤åª’ä½“ç»„', count: 1241, cost: 20.66 },
  { name: 'åˆè®¡', count: 35289, cost: 17.22 } ]
```

è¿™æ¬¡çš„è¾“å‡ºç»“æœå°±å’Œ`chrome`ä¸­ä¸€è‡´äº†ã€‚ä½†æ˜¯`chrome`ä¸­å®ç°è¿™æ®µæ’åºçš„ä»£ç åœ¨å“ªé‡ŒğŸ˜³ğŸ˜³ğŸ˜³ï¼Ÿ

æœ€åå‘¢ï¼Œå¯¹äºè¿™ç§åœºæ™¯ä¸‹çš„`iview`çš„è¡¨æ ¼æ’åºé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹å¼è§£å†³

- æ”¹æºç ï¼Œundefined || 0
- è‡ªå®šä¹‰sortMethod
- æ•°æ®ä¼ ç»™tableç»„ä»¶å‰ï¼Œè‡ªå·±åšä¸€ä¸‹åˆ¤æ–­ï¼Œå°½é‡é¿å…undefinedå‡ºç°