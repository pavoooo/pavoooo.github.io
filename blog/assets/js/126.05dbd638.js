(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{175:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("h1",[s._v("计划任务")]),s._v(" "),t("p",[t("code",[s._v("计划任务")]),s._v("就是让计算机在指定的时间运行程序。")]),s._v(" "),t("h2",{attrs:{id:"一次性计划任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一次性计划任务","aria-hidden":"true"}},[s._v("#")]),s._v(" 一次性计划任务")]),s._v(" "),t("p",[s._v("一次性计划任务我们可以使用"),t("code",[s._v("at")]),s._v("命令来定义")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@instance-6w9riila jikeshijian-linux"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token comment"}},[s._v("# at 21:40")]),s._v("\nat"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'hello'")]),s._v("  "),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" hello.txt\nat"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("EOT"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{attrs:{class:"token comment"}},[s._v("# ctrl+d")]),s._v("\njob 1 at Sat Jan 18 21:40:00 2020\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"danger custom-block"},[t("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),t("p",[s._v("计划任务是没有终端的，如果我们想获取到输出，需要将其重定向到一个文件中。")]),s._v(" "),t("p",[s._v("如果在计划任务中执行的脚本不在"),t("code",[s._v("$PATH")]),s._v("中，需要使用绝对路径来指定可执行脚本的路径。")])]),s._v(" "),t("h2",{attrs:{id:"周期性计划任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#周期性计划任务","aria-hidden":"true"}},[s._v("#")]),s._v(" 周期性计划任务")]),s._v(" "),t("p",[s._v("周期性计划任务使用"),t("code",[s._v("crontab")]),s._v("命令配置。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("配置方式")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -e\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("运行"),t("code",[s._v("crontab -e")]),s._v("命令会进入一个类似于"),t("code",[s._v("vim")]),s._v("的编辑界面")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@instance-6w9riila jikeshijian-linux"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token comment"}},[s._v("# crontab -e")]),s._v("\nno "),t("span",{attrs:{class:"token function"}},[s._v("crontab")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" root - using an empty one\ncrontab: installing new "),t("span",{attrs:{class:"token function"}},[s._v("crontab")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@instance-6w9riila jikeshijian-linux"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token comment"}},[s._v("# crontab -l")]),s._v("\n* * * * * /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# 每分钟运行一次date命令")]),s._v("\n* * * * * /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 周一和周五每分钟执行一次")]),s._v("\n* * * * 1,5 /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 星期一到星期五每分钟执行一次")]),s._v("\n* * * * 1-5 /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 七月七日，如果这一天在星期一到星期五那么就每分钟执行一次")]),s._v("\n* * 7 7 1-5 /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 七月七日，如果这一天在星期一到星期五那么就在18:15分执行一次")]),s._v("\n15 18 7 7 1-5 /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 每周一的03:30分执行一次命令")]),s._v("\n30 3 * * 1 /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 每个月的15日的3:30分执行一次命令")]),s._v("\n30 3 15 * * /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 每个月的15日的3:00整执行一次命令")]),s._v("\n0 3 15 * * /usr/bin/date "),t("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/date.txt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("每个用户创建的计划任务都在"),t("code",[s._v("/var/spool/cron/")]),s._v("下的用户名下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@instance-6w9riila jikeshijian-linux"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token comment"}},[s._v("# ls /var/spool/cron/")]),s._v("\nroot\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("查看现有的计划任务")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -l\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@instance-6w9riila jikeshijian-linux"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{attrs:{class:"token comment"}},[s._v("# crontab -l")]),s._v("\nno "),t("span",{attrs:{class:"token function"}},[s._v("crontab")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" root\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("配置格式")])])]),s._v(" "),t("p",[t("code",[s._v("分钟 小时 日期 月份 星期 执行的命令")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("*")]),s._v("表示任意的。比如"),t("code",[s._v("* * * * * date")]),s._v("表示每分钟执行一次"),t("code",[s._v("date")]),s._v("命令")])]),s._v(" "),t("blockquote",[t("p",[s._v("配置周期性的计划任务的时候，同样需要注意命令的路径问题")])]),s._v(" "),t("h2",{attrs:{id:"计划任务加锁flock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#计划任务加锁flock","aria-hidden":"true"}},[s._v("#")]),s._v(" 计划任务加锁flock")]),s._v(" "),t("p",[s._v("给计划任务加锁就是为了防止计算机不能按照预期的时间运行我们的计划任务。我们可以通过下面两个方式处理：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("anacontab")]),s._v("延时计划任务")])]),s._v(" "),t("p",[s._v("延时计划任务在"),t("code",[s._v("/etc/cron.d/0hourly")]),s._v("中。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token comment"}},[s._v("# Run the hourly jobs")]),s._v("\nSHELL"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/bash\nPATH"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin:/bin:/usr/sbin:/usr/bin\nMAILTO"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n01 * * * * root run-parts /etc/cron.hourly\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("code",[s._v("/etc/anacrontab")]),s._v("也是一个和延时计划任务相关的配置文件。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("flock")]),s._v("锁文件")])]),s._v(" "),t("blockquote",[t("p",[s._v("详细了解下")])]),s._v(" "),t("p",[s._v("这个命令可以让某个文件在同一时间只能运行一次，就是如果长时间运行的脚本，在这次运行没有结束的时候，不能再次运行这个脚本。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("flock -xn "),t("span",{attrs:{class:"token string"}},[s._v('"/tmp/f.lock"')]),s._v(" -c "),t("span",{attrs:{class:"token string"}},[s._v('" /root/a.sh"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}],!1,null,null,null);e.options.__file="33-计划任务.md";a.default=e.exports}}]);